<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Pro Analyst - Premium AI Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Animate.css for smooth animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gold-gradient: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --silver-gradient: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
            --bronze-gradient: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
            --premium-bg: radial-gradient(circle at 50% 0%, #0a0a2a 0%, #000 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --accent: #FF0080;
            --success: #00ff88;
            --danger: #ff4757;
            --warning: #ffcc00;
            --info: #00bfff;
            --text-primary: #ffffff;
            --text-secondary: #b0b0ff;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff9d;
        }

        body {
            background: var(--premium-bg);
            color: var(--text-primary);
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 0, 128, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 243, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 157, 0.1) 0%, transparent 40%);
            z-index: -2;
            pointer-events: none;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        .particle:nth-child(2n) {
            background: var(--neon-pink);
            animation-duration: 20s;
        }

        .particle:nth-child(3n) {
            background: var(--neon-green);
            animation-duration: 25s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20vw, 40vh) rotate(90deg); }
            50% { transform: translate(40vw, 10vh) rotate(180deg); }
            75% { transform: translate(60vw, 30vh) rotate(270deg); }
        }

        /* Popup Overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(15px);
        }

        .popup-content {
            background: rgba(30, 30, 70, 0.95);
            padding: 40px;
            border-radius: 30px;
            max-width: 500px;
            width: 90%;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            box-shadow: 
                0 0 50px rgba(0, 179, 255, 0.3),
                0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: pulse-glow 2s infinite alternate;
        }

        .popup-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff0080, #00f3ff, #ff0080);
            border-radius: 32px;
            z-index: -1;
            animation: rotate-gradient 3s linear infinite;
        }

        @keyframes rotate-gradient {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 50px rgba(0, 179, 255, 0.3), 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 70px rgba(0, 179, 255, 0.5), 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        }

        /* Button Styles */
        .btn-primary-custom {
            background: linear-gradient(135deg, #0088cc, #00b3ff);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.4s;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(0, 136, 204, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-primary-custom::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn-primary-custom:hover::before {
            left: 100%;
        }

        .btn-primary-custom:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 136, 204, 0.6);
        }

        .btn-success-custom {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.4s;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-success-custom:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 255, 136, 0.6);
        }

        /* Input Styles */
        .input-custom {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .input-custom:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
            background: rgba(255, 255, 255, 0.15);
        }

        /* Premium Header */
        .premium-header {
            background: rgba(10, 10, 40, 0.8);
            backdrop-filter: blur(20px);
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .header-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 0, 128, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 243, 255, 0.2) 0%, transparent 50%);
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid rgba(255, 71, 87, 0.3);
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 71, 87, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 71, 87, 0.8); }
        }

        /* Access Timer */
        .access-timer {
            background: rgba(255, 0, 128, 0.1);
            border: 2px solid rgba(255, 0, 128, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .timer-display {
            font-size: 32px;
            font-weight: 900;
            color: #ff0080;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(255, 0, 128, 0.7);
            letter-spacing: 2px;
        }

        /* Period Info */
        .period-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            margin: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 179, 255, 0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .period-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff0080, #00f3ff);
        }

        .period-number {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 243, 255, 0.5);
            letter-spacing: 2px;
        }

        /* Results History */
        .results-container {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 30px;
            flex-wrap: wrap;
        }

        .result-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 20px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .result-circle:hover {
            transform: scale(1.2) rotate(10deg);
            box-shadow: 0 0 25px currentColor;
            z-index: 10;
        }

        .result-big-red { 
            background: linear-gradient(135deg, #ff4757, #ff002b);
            color: white;
        }
        
        .result-small-red { 
            background: linear-gradient(135deg, #ff7b00, #ff5500);
            color: white;
        }
        
        .result-big-green { 
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: white;
        }
        
        .result-small-green { 
            background: linear-gradient(135deg, #00bfff, #0088cc);
            color: white;
        }

        /* Predictors Grid */
        .predictors-container {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .predictor-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .predictor-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--neon-blue);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 243, 255, 0.3);
        }

        .predictor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: 0.5s;
        }

        .predictor-card:hover::before {
            left: 100%;
        }

        .predictor-rank {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 16px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .predictor-rank-1 { 
            background: var(--gold-gradient);
            animation: glow-gold 2s infinite alternate;
        }
        
        .predictor-rank-2 { 
            background: var(--silver-gradient);
            animation: glow-silver 2s infinite alternate;
        }
        
        .predictor-rank-3 { 
            background: var(--bronze-gradient);
            animation: glow-bronze 2s infinite alternate;
        }
        
        .predictor-rank-4 { 
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        @keyframes glow-gold {
            0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }

        @keyframes glow-silver {
            0% { box-shadow: 0 0 10px rgba(192, 192, 192, 0.5); }
            100% { box-shadow: 0 0 25px rgba(192, 192, 192, 0.8); }
        }

        @keyframes glow-bronze {
            0% { box-shadow: 0 0 10px rgba(205, 127, 50, 0.5); }
            100% { box-shadow: 0 0 25px rgba(205, 127, 50, 0.8); }
        }

        .predictor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            object-fit: cover;
            border: 3px solid var(--neon-blue);
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            transition: all 0.3s;
        }

        .predictor-card:hover .predictor-avatar {
            border-color: var(--neon-pink);
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.7);
        }

        .predictor-name {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 10px;
            color: var(--text-primary);
            background: linear-gradient(135deg, #ffffff, #b0b0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .accuracy-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid rgba(0, 255, 136, 0.3);
            backdrop-filter: blur(10px);
        }

        .prediction-display {
            background: rgba(0, 243, 255, 0.1);
            padding: 18px;
            border-radius: 18px;
            margin-top: 20px;
            border: 1px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .prediction-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff0080, #00f3ff);
        }

        .prediction-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .prediction-value {
            font-size: 26px;
            font-weight: 900;
            color: #00f3ff;
            letter-spacing: 1px;
        }

        .prediction-status {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-pending { 
            background: rgba(255, 204, 0, 0.2); 
            color: #ffcc00;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        
        .status-win { 
            background: rgba(0, 255, 136, 0.2); 
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
            animation: pulse-win 2s infinite;
        }
        
        .status-loss { 
            background: rgba(255, 71, 87, 0.2); 
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        @keyframes pulse-win {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
        }

        /* Task Cards */
        .task-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin: 15px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
        }

        .task-card:hover {
            border-color: var(--neon-blue);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 243, 255, 0.2);
        }

        .task-reward {
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            color: white;
            padding: 8px 15px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 14px;
            display: inline-block;
            margin-top: 10px;
        }

        /* Referral Section */
        .referral-card {
            background: rgba(0, 243, 255, 0.1);
            border-radius: 20px;
            padding: 25px;
            margin: 20px 0;
            border: 2px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(10px);
        }

        .referral-link {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 15px;
            padding: 15px;
            margin: 15px 0;
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .referral-link input {
            flex: 1;
            background: transparent;
            border: none;
            color: white;
            font-size: 16px;
            padding: 10px;
        }

        .referral-link input:focus {
            outline: none;
        }

        /* Stats Cards */
        .stats-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            margin: 15px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .stats-value {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 10px;
        }

        .stats-label {
            font-size: 14px;
            color: #b0b0ff;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 60px;
            background: rgba(10, 10, 40, 0.5);
            backdrop-filter: blur(20px);
        }

        /* Responsive */
        @media (max-width: 768px) {
            .predictors-container {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .period-number {
                font-size: 28px;
            }
            
            .popup-content {
                padding: 20px;
            }
            
            .result-circle {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .timer-display {
                font-size: 24px;
            }
        }

        /* Loading Animation */
        .loading-shimmer {
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.05) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 10px;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 10, 40, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff3399, #33ffff);
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Registration Popup -->
    <div id="registrationPopup" class="popup-overlay">
        <div class="popup-content">
            <div class="text-center mb-4">
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-user-shield"></i> Register Account
                </h2>
                <p style="color: #b0b0ff;">Create your account to access premium predictions</p>
            </div>
            
            <div id="registrationForm">
                <input type="tel" class="input-custom" id="registerPhone" placeholder="Enter Phone Number" required>
                <input type="password" class="input-custom" id="registerPassword" placeholder="Create Password (min 6 characters)" required>
                <input type="password" class="input-custom" id="confirmPassword" placeholder="Confirm Password" required>
                
                <div class="referral-code-section mb-3">
                    <input type="text" class="input-custom" id="referralCode" placeholder="Referral Code (Optional)">
                </div>
                
                <button class="btn-primary-custom" onclick="registerUser()">
                    <i class="fas fa-user-plus"></i> REGISTER NOW
                </button>
                
                <p class="text-center mt-3" style="color: #b0b0ff;">
                    Already have an account? 
                    <a href="#" onclick="showLogin()" style="color: #00f3ff; text-decoration: none;">Login Here</a>
                </p>
            </div>
            
            <div id="loginForm" style="display: none;">
                <input type="tel" class="input-custom" id="loginPhone" placeholder="Phone Number" required>
                <input type="password" class="input-custom" id="loginPassword" placeholder="Password" required>
                
                <button class="btn-primary-custom" onclick="loginUser()">
                    <i class="fas fa-sign-in-alt"></i> LOGIN
                </button>
                
                <p class="text-center mt-3" style="color: #b0b0ff;">
                    Don't have an account? 
                    <a href="#" onclick="showRegister()" style="color: #00f3ff; text-decoration: none;">Register Here</a>
                </p>
            </div>
            
            <div id="registrationMessage" class="mt-3" style="display: none;"></div>
        </div>
    </div>

    <!-- Telegram Popup -->
    <div id="telegramPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="text-center mb-4">
                <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #0088cc, #00b3ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 48px; color: white; box-shadow: 0 0 30px rgba(0, 179, 255, 0.7);">
                    <i class="fab fa-telegram-plane"></i>
                </div>
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Join Our Channels</h2>
                <p style="color: #b0b0ff;">Join both channels to unlock predictions</p>
            </div>
            
            <button class="btn-primary-custom" id="joinBtn1" onclick="joinTelegram(1)">
                <i class="fab fa-telegram-plane"></i> Join Channel 1
            </button>
            <div id="status1" class="text-center mt-2" style="display: none; color: #00f3ff; font-weight: 700;">
                <i class="fas fa-spinner fa-spin"></i> Checking join status...
            </div>
            <div id="joined1" class="text-center mt-2" style="display: none; color: #00ff88; font-weight: 700;">
                <i class="fas fa-check-circle"></i> Joined Successfully
            </div>
            
            <div class="mt-3"></div>
            
            <button class="btn-primary-custom" id="joinBtn2" onclick="joinTelegram(2)" disabled>
                <i class="fab fa-telegram-plane"></i> Join Channel 2
            </button>
            <div id="status2" class="text-center mt-2" style="display: none; color: #00f3ff; font-weight: 700;">
                <i class="fas fa-spinner fa-spin"></i> Checking join status...
            </div>
            <div id="joined2" class="text-center mt-2" style="display: none; color: #00ff88; font-weight: 700;">
                <i class="fas fa-check-circle"></i> Joined Successfully
            </div>
            
            <div id="telegramComplete" style="display: none; margin-top: 30px;">
                <button class="btn-success-custom" onclick="completeTelegramTask()">
                    <i class="fas fa-check-double"></i> TASKS COMPLETED - CONTINUE
                </button>
            </div>
        </div>
    </div>

    <!-- Referral Tasks Popup -->
    <div id="tasksPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="text-center mb-4">
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-tasks"></i> Complete Tasks
                </h2>
                <p style="color: #b0b0ff;">Complete tasks to unlock premium predictions</p>
            </div>
            
            <!-- Referral Stats -->
            <div class="row text-center mb-4">
                <div class="col-6">
                    <div class="stats-card">
                        <div class="stats-value" id="referralCount">0</div>
                        <div class="stats-label">Referrals</div>
                    </div>
                </div>
                <div class="col-6">
                    <div class="stats-card">
                        <div class="stats-value" id="accessDays">0</div>
                        <div class="stats-label">Access Days</div>
                    </div>
                </div>
            </div>
            
            <!-- Referral Link -->
            <div class="referral-card">
                <h5 class="mb-3" style="color: #00f3ff; font-weight: 700;">
                    <i class="fas fa-share-alt"></i> Your Referral Link
                </h5>
                <div class="referral-link">
                    <input type="text" id="referralLinkInput" readonly value="Loading...">
                    <button class="btn btn-sm btn-primary" onclick="copyReferralLink()">
                        <i class="fas fa-copy"></i>
                    </button>
                </div>
                <p class="small text-center mt-2" style="color: #b0b0ff;">
                    Share this link with friends. When they register, your referral count increases.
                </p>
            </div>
            
            <!-- Tasks List -->
            <div class="mt-4">
                <h5 class="mb-3" style="color: #00f3ff; font-weight: 700;">
                    <i class="fas fa-gift"></i> Referral Rewards
                </h5>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">1 Referral</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 1 referral</p>
                        </div>
                        <div class="task-reward">24 Hours Access</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task1Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">3 Referrals</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 3 referrals</p>
                        </div>
                        <div class="task-reward">7 Days Access</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task3Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">5 Referrals</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 5 referrals</p>
                        </div>
                        <div class="task-reward">15 Days Access</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task5Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">20 Referrals</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 20 referrals</p>
                        </div>
                        <div class="task-reward">₹100 + 30 Days Access</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task20Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">40 Referrals</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 40 referrals</p>
                        </div>
                        <div class="task-reward">₹250 + 3 Months Access</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task40Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
                
                <div class="task-card">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 style="font-weight: 700; color: white;">100 Referrals</h6>
                            <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">Complete 100 referrals</p>
                        </div>
                        <div class="task-reward">₹2000 + Lifetime Access + VIP Channel</div>
                    </div>
                    <div class="progress mt-2" style="height: 8px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                        <div class="progress-bar" id="task100Progress" role="progressbar" style="background: linear-gradient(90deg, #ff0080, #00f3ff); border-radius: 10px;"></div>
                    </div>
                </div>
            </div>
            
            <button class="btn-success-custom mt-4" onclick="accessDashboard()" id="accessDashboardBtn" disabled>
                <i class="fas fa-rocket"></i> ACCESS DASHBOARD
            </button>
            
            <p class="text-center mt-3 small" style="color: #b0b0ff;">
                Complete at least 1 referral to access predictions
            </p>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" style="display: none;">
        <!-- Premium Header -->
        <div class="premium-header">
            <div class="header-glow"></div>
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-1" style="font-weight: 900; font-size: 32px;">
                            <i class="fas fa-crown" style="background: linear-gradient(135deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i> 
                            <span style="background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">WinGo Pro Analyst</span>
                        </h2>
                        <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">
                            <i class="fas fa-user"></i> <span id="userPhoneDisplay"></span> | 
                            <span id="accessStatus" style="color: #00ff88;"></span>
                        </p>
                    </div>
                    <div>
                        <div class="live-indicator">
                            <i class="fas fa-circle"></i> LIVE PREDICTIONS
                        </div>
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="showTasksPopup()">
                            <i class="fas fa-tasks"></i> Tasks
                        </button>
                        <button class="btn btn-sm btn-outline-danger ms-2" onclick="logoutUser()">
                            <i class="fas fa-sign-out-alt"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Access Timer -->
        <div class="access-timer">
            <div class="small mb-2" style="color: #b0b0ff;">Access Remaining</div>
            <div class="timer-display" id="accessTimer">00:00:00</div>
            <div class="small mt-2" style="color: #ff0080;">
                <i class="fas fa-clock"></i> Complete more referrals to extend access
            </div>
        </div>

        <!-- Live Period Info -->
        <div class="period-card animate__animated animate__fadeIn">
            <div class="row align-items-center">
                <div class="col-md-12 text-center">
                    <div class="mb-2" style="color: #b0b0ff; font-size: 14px;">Next Period</div>
                    <div class="period-number" id="currentPeriod">Loading...</div>
                    <div class="small mt-2" id="periodSource" style="color: #b0b0ff;">Source: Connecting...</div>
                    <div class="mt-3" style="color: #00f3ff; font-size: 14px;">
                        <i class="fas fa-sync-alt"></i> Auto-refresh every 5 seconds
                    </div>
                </div>
            </div>
        </div>

        <!-- Latest Results -->
        <div class="container animate__animated animate__fadeInUp">
            <div class="text-center mb-4">
                <h5 style="font-weight: 700; color: #ffffff; font-size: 24px;">
                    <i class="fas fa-history" style="color: #00f3ff;"></i> Latest Results
                </h5>
                <p style="color: #b0b0ff;">Last 10 periods with real-time updates</p>
            </div>
            <div class="results-container" id="latestResults">
                <!-- Results will be loaded here -->
            </div>
        </div>

        <!-- Predictors Grid -->
        <div class="container animate__animated animate__fadeInUp">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 style="font-weight: 900; font-size: 28px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-chart-line" style="color: #00f3ff;"></i> Premium Predictors
                </h4>
                <span class="text-muted" id="lastUpdate" style="color: #b0b0ff; font-size: 14px;">Last updated: --</span>
            </div>
            <div class="predictors-container" id="predictorsContainer">
                <!-- Predictors will be loaded here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="container">
                <p style="font-size: 16px; margin-bottom: 15px;">
                    <i class="fas fa-shield-alt" style="color: #00f3ff;"></i> All predictions are AI-generated using advanced algorithms
                </p>
                <p class="mb-0" style="font-size: 14px;">
                    Real-time sync across all devices • Auto-update every 5 seconds • Premium Analytics
                </p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Firebase Configuration - UPDATED
        const firebaseConfig = {
            apiKey: "AIzaSyBHLb-g-WUe8AuiVRIOVolh1MTXF1u7dOc",
            authDomain: "colour-games-dfe2d.firebaseapp.com",
            databaseURL: "https://colour-games-dfe2d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "colour-games-dfe2d",
            storageBucket: "colour-games-dfe2d.firebasestorage.app",
            messagingSenderId: "92918980466",
            appId: "1:92918980466:web:137e6bc678c0fa76ff07eb",
            measurementId: "G-D7C15NMDJD"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // API Configuration
        const API_URL = "https://harshpredictor.site/api/api.php";

        // DOM Elements
        const registrationPopup = document.getElementById('registrationPopup');
        const telegramPopup = document.getElementById('telegramPopup');
        const tasksPopup = document.getElementById('tasksPopup');
        const mainDashboard = document.getElementById('mainDashboard');
        const registrationForm = document.getElementById('registrationForm');
        const loginForm = document.getElementById('loginForm');
        const accessDashboardBtn = document.getElementById('accessDashboardBtn');

        // Global Variables
        let currentUser = null;
        let userData = null;
        let refreshInterval;
        let accessTimerInterval;
        let isFirstChannelJoined = false;
        let isSecondChannelJoined = false;
        let currentLivePeriod = null;
        let currentLiveResult = null;
        let predictorData = [];
        let lastResultList = [];
        let processedPeriods = new Set();
        let deviceId = null;

        // Predictor Details
        const predictorNames = [
            "Quantum Oracle V2",
            "Alpha Predict AI", 
            "Neural Prophet X1",
            "Cyber Seer Elite",
            "Synapse Mastermind",
            "Digital Oracle Max",
            "Neuro Vision Ultra",
            "Quantum Mind Plus",
            "AI Oracle Premium",
            "Neural Network Pro"
        ];

        // Predictor Avatars - Updated with correct file names
        const avatars = [
            "predict1.png",
            "predict2.png",
            "predict3.png",
            "predict4.png",
            "predict5.png",
            "predict6.png",
            "predict7.png",
            "predict8.png",
            "predict9.png",
            "predict10.png"
        ];

        // Number color mapping
        const NUMBER_COLOR_MAP = {
            0: {color: 'RED', violet: true},
            1: {color: 'GREEN', violet: false},
            2: {color: 'RED', violet: false},
            3: {color: 'GREEN', violet: false},
            4: {color: 'RED', violet: false},
            5: {color: 'GREEN', violet: true},
            6: {color: 'RED', violet: false},
            7: {color: 'GREEN', violet: false},
            8: {color: 'RED', violet: false},
            9: {color: 'GREEN', violet: false}
        };

        // Generate Device ID
        function generateDeviceId() {
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.floor(Math.random() * 1000000);
                localStorage.setItem('deviceId', deviceId);
            }
            return deviceId;
        }

        // Show Registration Form
        function showRegister() {
            registrationForm.style.display = 'block';
            loginForm.style.display = 'none';
        }

        // Show Login Form
        function showLogin() {
            registrationForm.style.display = 'none';
            loginForm.style.display = 'block';
        }

        // Register User - UPDATED WITH MULTIPLE CHECKS
        function registerUser() {
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            const referralCode = document.getElementById('referralCode').value.trim();
            
            // Validation
            if (!phone) {
                showMessage('Please enter phone number', 'danger');
                return;
            }
            
            if (!password) {
                showMessage('Please enter password', 'danger');
                return;
            }
            
            if (password.length < 6) {
                showMessage('Password must be at least 6 characters', 'danger');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'danger');
                return;
            }
            
            // Check if phone already exists
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showMessage('Phone number already registered. Please login.', 'danger');
                        return;
                    }
                    
                    // Check device registration limit (max 1 account per device)
                    const deviceId = generateDeviceId();
                    return database.ref('users').orderByChild('deviceId').equalTo(deviceId).once('value')
                        .then(deviceSnapshot => {
                            if (deviceSnapshot.exists()) {
                                showMessage('This device already has a registered account. Please login.', 'danger');
                                return;
                            }
                            
                            // Generate user ID
                            const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                            
                            // Create user data
                            const newUserData = {
                                phone: phone,
                                password: password,
                                userId: userId,
                                deviceId: deviceId,
                                referralCode: generateReferralCode(),
                                referredBy: referralCode || null,
                                referralCount: 0,
                                accessUntil: null,
                                telegramTasks: {
                                    channel1: false,
                                    channel2: false
                                },
                                tasksCompleted: false,
                                registeredAt: Date.now(),
                                lastLogin: Date.now(),
                                isLoggedIn: false,
                                loginDevice: null
                            };
                            
                            // Save user to database
                            return database.ref('users/' + userId).set(newUserData)
                                .then(() => {
                                    // Update referrer if referral code provided
                                    if (referralCode) {
                                        updateReferrerCount(referralCode, phone);
                                    }
                                    
                                    // Set current user
                                    currentUser = userId;
                                    userData = newUserData;
                                    
                                    // Save login state
                                    localStorage.setItem('loggedInUser', userId);
                                    localStorage.setItem('userData', JSON.stringify(newUserData));
                                    localStorage.setItem('registeredDevice', deviceId);
                                    
                                    // Show success message
                                    showMessage('Registration successful!', 'success');
                                    
                                    // Hide registration and show telegram popup
                                    setTimeout(() => {
                                        registrationPopup.style.display = 'none';
                                        showTelegramPopup();
                                    }, 1500);
                                });
                        });
                })
                .catch(error => {
                    console.error('Registration error:', error);
                    showMessage('Registration failed: ' + error.message, 'danger');
                });
        }

        // Generate referral code
        function generateReferralCode() {
            return 'REF' + Math.random().toString(36).substr(2, 6).toUpperCase();
        }

        // Update referrer count with SMS notification
        function updateReferrerCount(referralCode, newUserPhone) {
            // Find user with this referral code
            database.ref('users').orderByChild('referralCode').equalTo(referralCode).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        const referrerKey = Object.keys(snapshot.val())[0];
                        const referrerData = snapshot.val()[referrerKey];
                        
                        // Update referral count
                        const newCount = (referrerData.referralCount || 0) + 1;
                        database.ref('users/' + referrerKey + '/referralCount').set(newCount)
                            .then(() => {
                                // Update access based on new count
                                updateUserAccess(referrerKey, newCount);
                                
                                // Send notification to referrer
                                sendReferralNotification(referrerKey, newCount, newUserPhone);
                                
                                // If the referrer is the current user, update the tasks display
                                if (referrerKey === currentUser) {
                                    updateTasksDisplay();
                                }
                            });
                    }
                });
        }

        // Send referral notification via Firebase
        function sendReferralNotification(userId, referralCount, newUserPhone) {
            const notification = {
                type: 'referral',
                message: `Your ${referralCount} referral complete. New user: ${newUserPhone}. Please check website for rewards.`,
                timestamp: Date.now(),
                read: false
            };
            
            // Store notification in database
            database.ref('notifications/' + userId).push(notification);
            
            // Also store in user's notifications list
            database.ref('users/' + userId + '/notifications').once('value')
                .then(snapshot => {
                    const notifications = snapshot.val() || [];
                    notifications.push(notification);
                    database.ref('users/' + userId + '/notifications').set(notifications.slice(-10)); // Keep last 10
                });
        }

        // Login User - UPDATED WITH MULTI-DEVICE SUPPORT
        function loginUser() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!phone || !password) {
                showMessage('Please enter phone and password', 'danger');
                return;
            }
            
            // Find user by phone
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        showMessage('Phone number not registered', 'danger');
                        return;
                    }
                    
                    const userKey = Object.keys(snapshot.val())[0];
                    const user = snapshot.val()[userKey];
                    
                    // Check password
                    if (user.password !== password) {
                        showMessage('Invalid password', 'danger');
                        return;
                    }
                    
                    // Check if user is already logged in on another device
                    const newDeviceId = generateDeviceId();
                    
                    // If user is logged in on another device, log them out
                    if (user.isLoggedIn && user.loginDevice && user.loginDevice !== newDeviceId) {
                        // Logout from previous device
                        database.ref('users/' + userKey).update({
                            isLoggedIn: false,
                            loginDevice: null
                        });
                        
                        // Clear previous device's localStorage
                        // Note: This is handled on the client side when they try to use the app
                    }
                    
                    // Update login status with new device
                    return database.ref('users/' + userKey).update({
                        deviceId: newDeviceId,
                        lastLogin: Date.now(),
                        isLoggedIn: true,
                        loginDevice: newDeviceId
                    })
                    .then(() => {
                        // Set current user
                        currentUser = userKey;
                        userData = user;
                        userData.deviceId = newDeviceId;
                        userData.isLoggedIn = true;
                        userData.loginDevice = newDeviceId;
                        
                        // Save login state
                        localStorage.setItem('loggedInUser', userKey);
                        localStorage.setItem('userData', JSON.stringify(userData));
                        localStorage.setItem('registeredDevice', newDeviceId);
                        
                        // Hide registration popup
                        registrationPopup.style.display = 'none';
                        
                        // Check user status and show appropriate popup
                        if (!user.tasksCompleted) {
                            showTelegramPopup();
                        } else if (!user.accessUntil || user.accessUntil < Date.now()) {
                            showTasksPopup();
                        } else {
                            showDashboard();
                        }
                    });
                })
                .catch(error => {
                    console.error('Login error:', error);
                    showMessage('Login failed: ' + error.message, 'danger');
                });
        }

        // Show Message
        function showMessage(message, type) {
            const messageDiv = document.getElementById('registrationMessage');
            messageDiv.style.display = 'block';
            messageDiv.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" style="background: ${type === 'success' ? 'rgba(0,255,136,0.2)' : 'rgba(255,71,87,0.2)'}; border-color: ${type === 'success' ? '#00ff88' : '#ff4757'}; color: white;">
                    ${message}
                    <button type="button" class="btn-close btn-close-white" onclick="this.parentElement.style.display='none'"></button>
                </div>
            `;
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Show Telegram Popup
        function showTelegramPopup() {
            telegramPopup.style.display = 'flex';
            tasksPopup.style.display = 'none';
            mainDashboard.style.display = 'none';
        }

        // Join Telegram Channel
        function joinTelegram(channel) {
            if (channel === 1) {
                // Open Telegram channel
                window.open('https://t.me/+8GtO9R-G56k5OTE1', '_blank');
                
                // Show checking status
                document.getElementById('status1').style.display = 'block';
                document.getElementById('joinBtn1').disabled = true;
                
                // Fake checking for 10 seconds
                setTimeout(() => {
                    document.getElementById('status1').style.display = 'none';
                    document.getElementById('joined1').style.display = 'block';
                    isFirstChannelJoined = true;
                    
                    // Update in database
                    if (currentUser) {
                        database.ref('users/' + currentUser + '/telegramTasks/channel1').set(true);
                    }
                    
                    // Enable second button
                    document.getElementById('joinBtn2').disabled = false;
                    
                    checkTelegramCompletion();
                }, 10000);
            } else if (channel === 2) {
                // Open Telegram channel
                window.open('https://t.me/+yCsZtJDFQvtlZjNl', '_blank');
                
                // Show checking status
                document.getElementById('status2').style.display = 'block';
                document.getElementById('joinBtn2').disabled = true;
                
                // Fake checking for 10 seconds
                setTimeout(() => {
                    document.getElementById('status2').style.display = 'none';
                    document.getElementById('joined2').style.display = 'block';
                    isSecondChannelJoined = true;
                    
                    // Update in database
                    if (currentUser) {
                        database.ref('users/' + currentUser + '/telegramTasks/channel2').set(true);
                    }
                    
                    checkTelegramCompletion();
                }, 10000);
            }
        }

        // Check Telegram Completion
        function checkTelegramCompletion() {
            if (isFirstChannelJoined && isSecondChannelJoined) {
                setTimeout(() => {
                    document.getElementById('telegramComplete').style.display = 'block';
                }, 1000);
            }
        }

        // Complete Telegram Task
        function completeTelegramTask() {
            if (!currentUser) return;
            
            database.ref('users/' + currentUser).update({
                tasksCompleted: true
            })
            .then(() => {
                userData.tasksCompleted = true;
                telegramPopup.style.display = 'none';
                showTasksPopup();
            });
        }

        // Show Tasks Popup
        function showTasksPopup() {
            tasksPopup.style.display = 'flex';
            telegramPopup.style.display = 'none';
            mainDashboard.style.display = 'none';
            
            if (currentUser && userData) {
                updateTasksDisplay();
            }
        }

        // Update Tasks Display
        function updateTasksDisplay() {
            const referralCount = userData.referralCount || 0;
            
            // Update stats
            document.getElementById('referralCount').textContent = referralCount;
            document.getElementById('accessDays').textContent = calculateAccessDays(userData.accessUntil);
            
            // Update referral link
            const referralLink = window.location.origin + window.location.pathname + '?ref=' + userData.referralCode;
            document.getElementById('referralLinkInput').value = referralLink;
            
            // Update progress bars
            updateProgressBar('task1Progress', Math.min(referralCount, 1) / 1 * 100);
            updateProgressBar('task3Progress', Math.min(referralCount, 3) / 3 * 100);
            updateProgressBar('task5Progress', Math.min(referralCount, 5) / 5 * 100);
            updateProgressBar('task20Progress', Math.min(referralCount, 20) / 20 * 100);
            updateProgressBar('task40Progress', Math.min(referralCount, 40) / 40 * 100);
            updateProgressBar('task100Progress', Math.min(referralCount, 100) / 100 * 100);
            
            // Enable dashboard button if at least 1 referral
            if (referralCount >= 1) {
                accessDashboardBtn.disabled = false;
            } else {
                accessDashboardBtn.disabled = true;
            }
        }

        // Update Progress Bar
        function updateProgressBar(elementId, percentage) {
            const element = document.getElementById(elementId);
            if (element) {
                element.style.width = percentage + '%';
            }
        }

        // Calculate Access Days
        function calculateAccessDays(accessUntil) {
            if (!accessUntil || accessUntil < Date.now()) {
                return 0;
            }
            const days = Math.ceil((accessUntil - Date.now()) / (1000 * 60 * 60 * 24));
            return days > 0 ? days : 0;
        }

        // Update User Access
        function updateUserAccess(userId, referralCount) {
            let accessDays = 0;
            let freeDeposit = 0;
            
            // Calculate access based on referral count
            if (referralCount >= 100) {
                accessDays = 36500; // 100 years for lifetime
                freeDeposit = 2000;
            } else if (referralCount >= 40) {
                accessDays = 90; // 3 months
                freeDeposit = 250;
            } else if (referralCount >= 20) {
                accessDays = 30;
                freeDeposit = 100;
            } else if (referralCount >= 5) {
                accessDays = 15;
            } else if (referralCount >= 3) {
                accessDays = 7;
            } else if (referralCount >= 1) {
                accessDays = 1;
            }
            
            // Calculate access until timestamp
            const accessUntil = accessDays > 0 ? Date.now() + (accessDays * 24 * 60 * 60 * 1000) : null;
            
            // Update user in database
            database.ref('users/' + userId).update({
                accessUntil: accessUntil,
                freeDeposit: freeDeposit
            });
            
            // If it's the current user, update local data
            if (userId === currentUser) {
                userData.accessUntil = accessUntil;
                userData.freeDeposit = freeDeposit;
                updateTasksDisplay();
            }
        }

        // Copy Referral Link
        function copyReferralLink() {
            const input = document.getElementById('referralLinkInput');
            input.select();
            input.setSelectionRange(0, 99999);
            document.execCommand('copy');
            
            // Show copied message
            const originalText = input.value;
            input.value = 'Copied to clipboard!';
            setTimeout(() => {
                input.value = originalText;
            }, 2000);
        }

        // Access Dashboard
        function accessDashboard() {
            // Give at least 24 hours access if user has at least 1 referral
            if (userData.referralCount >= 1 && (!userData.accessUntil || userData.accessUntil < Date.now())) {
                const accessUntil = Date.now() + (24 * 60 * 60 * 1000);
                database.ref('users/' + currentUser).update({
                    accessUntil: accessUntil,
                    isLoggedIn: true,
                    loginDevice: deviceId
                });
                userData.accessUntil = accessUntil;
            }
            
            tasksPopup.style.display = 'none';
            showDashboard();
        }

        // Show Dashboard
        function showDashboard() {
            mainDashboard.style.display = 'block';
            telegramPopup.style.display = 'none';
            tasksPopup.style.display = 'none';
            registrationPopup.style.display = 'none';
            
            // Update user info
            document.getElementById('userPhoneDisplay').textContent = userData.phone;
            
            // Start access timer
            startAccessTimer();
            
            // Initialize dashboard
            initializeDashboard();
        }

        // Start Access Timer
        function startAccessTimer() {
            if (accessTimerInterval) {
                clearInterval(accessTimerInterval);
            }
            
            function updateTimer() {
                if (!userData.accessUntil) {
                    document.getElementById('accessTimer').textContent = '00:00:00';
                    document.getElementById('accessStatus').textContent = 'No Access';
                    document.getElementById('accessStatus').style.color = '#ff4757';
                    return;
                }
                
                const now = Date.now();
                const remaining = userData.accessUntil - now;
                
                if (remaining <= 0) {
                    document.getElementById('accessTimer').textContent = '00:00:00';
                    document.getElementById('accessStatus').textContent = 'Access Expired';
                    document.getElementById('accessStatus').style.color = '#ff4757';
                    
                    // Redirect to tasks page
                    setTimeout(() => {
                        showTasksPopup();
                    }, 3000);
                    return;
                }
                
                // Calculate days, hours, minutes, seconds
                const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                // Format timer display
                if (days > 0) {
                    document.getElementById('accessTimer').textContent = 
                        `${days}d ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    document.getElementById('accessTimer').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                document.getElementById('accessStatus').textContent = days > 0 ? `${days} Days Access` : `${hours} Hours Access`;
                document.getElementById('accessStatus').style.color = '#00ff88';
            }
            
            updateTimer();
            accessTimerInterval = setInterval(updateTimer, 1000);
        }

        // Initialize Dashboard
        function initializeDashboard() {
            // Create background particles
            createParticles();
            
            // Initialize predictors in Firebase if not exists
            initializePredictors();
            
            // Start live data fetching
            fetchLiveData();
            refreshInterval = setInterval(fetchLiveData, 5000);
            
            // Listen for Firebase changes
            listenToPredictorUpdates();
        }

        // Initialize Predictors in Firebase with correct avatars
        function initializePredictors() {
            database.ref('predictors/initialized').once('value').then(snapshot => {
                if (!snapshot.exists()) {
                    // Create initial predictors data
                    const predictors = {};
                    
                    predictorNames.forEach((name, index) => {
                        const predictorId = `predictor_${index + 1}`;
                        let initialAccuracy;
                        
                        // Set specific accuracies based on screenshot
                        if (name === "Quantum Oracle V2") {
                            initialAccuracy = 70;
                        } else if (name === "Alpha Predict AI") {
                            initialAccuracy = 64;
                        } else if (name === "Neural Prophet X1") {
                            initialAccuracy = 61;
                        } else {
                            initialAccuracy = Math.floor(Math.random() * 30) + 60; // 60-90%
                        }
                        
                        const totalPredictions = 33;
                        const wins = Math.floor((initialAccuracy / 100) * totalPredictions);
                        const losses = totalPredictions - wins;
                        
                        // Generate initial predictions
                        const predictions = [];
                        for (let i = 0; i < 10; i++) {
                            const isWin = i < wins;
                            const predictionType = Math.random() > 0.5 ? 'BIG' : 'SMALL';
                            const result = isWin ? 
                                (predictionType === 'BIG' ? Math.floor(Math.random() * 5) + 5 : Math.floor(Math.random() * 5)) : 
                                (predictionType === 'BIG' ? Math.floor(Math.random() * 5) : Math.floor(Math.random() * 5) + 5);
                            
                            predictions.push({
                                period: `100000${1000 + i}`,
                                prediction: predictionType,
                                result: result,
                                status: isWin ? 'WIN' : 'LOSS',
                                timestamp: Date.now() - (i * 60000)
                            });
                        }
                        
                        predictors[predictorId] = {
                            id: predictorId,
                            name: name,
                            avatar: avatars[index],
                            rank: index + 1,
                            accuracy: initialAccuracy,
                            totalPredictions: totalPredictions,
                            wins: wins,
                            losses: losses,
                            predictions: predictions,
                            currentPrediction: null,
                            lastUpdated: Date.now()
                        };
                    });
                    
                    // Save to Firebase
                    database.ref('predictors').set(predictors);
                    database.ref('predictors/initialized').set(true);
                }
            });
        }

        // Fetch Live Data from API
        async function fetchLiveData() {
            try {
                const response = await fetch(API_URL + "?v=" + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.data && data.data.list && data.data.list.length > 0) {
                        const latest = data.data.list[0];
                        const latestIssue = latest.issueNumber;
                        const latestNum = parseInt(latest.number);
                        
                        // Store latest data
                        currentLivePeriod = latestIssue;
                        currentLiveResult = latestNum;
                        lastResultList = data.data.list.slice(0, 10);
                        
                        // Calculate NEXT period
                        const nextPeriod = (BigInt(latestIssue) + 1n).toString();
                        
                        // Update UI with NEXT period
                        document.getElementById('currentPeriod').textContent = nextPeriod.slice(-7);
                        document.getElementById('periodSource').textContent = "Source: Online • Live Data";
                        
                        // Update latest results display
                        updateLatestResults();
                        
                        document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
                        
                        // Check and update predictions
                        checkAndUpdatePredictions(latestIssue, latestNum);
                        
                        // Generate new predictions for NEXT period
                        generateNewPredictions();
                    }
                }
            } catch (error) {
                console.error("API Error:", error);
                document.getElementById('periodSource').textContent = "Source: Offline • Using cached data";
            }
        }

        // Update latest results display
        function updateLatestResults() {
            const latestResults = document.getElementById('latestResults');
            latestResults.innerHTML = '';
            
            if (lastResultList.length > 0) {
                lastResultList.forEach((result, index) => {
                    const num = parseInt(result.number);
                    const isBig = num >= 5;
                    const color = NUMBER_COLOR_MAP[num].color;
                    
                    let className = '';
                    if (isBig && color === 'RED') className = 'result-big-red';
                    else if (!isBig && color === 'RED') className = 'result-small-red';
                    else if (isBig && color === 'GREEN') className = 'result-big-green';
                    else if (!isBig && color === 'GREEN') className = 'result-small-green';
                    
                    const resultDiv = document.createElement('div');
                    resultDiv.className = `result-circle ${className} animate__animated animate__flipInX`;
                    resultDiv.style.animationDelay = `${index * 0.1}s`;
                    resultDiv.textContent = num;
                    resultDiv.title = `Period: ${result.issueNumber.slice(-7)} • ${isBig ? 'BIG' : 'SMALL'} / ${color}`;
                    
                    latestResults.appendChild(resultDiv);
                });
            }
        }

        // Generate new predictions for NEXT period
        function generateNewPredictions() {
            if (!currentLivePeriod) return;
            
            // Calculate next period
            const nextPeriod = (BigInt(currentLivePeriod) + 1n).toString();
            
            database.ref('predictors').once('value').then(snapshot => {
                const predictors = snapshot.val();
                if (!predictors) return;
                
                // Generate same random prediction for all predictors
                const predictionType = Math.random() > 0.5 ? 'BIG' : 'SMALL';
                
                Object.keys(predictors).forEach(predictorId => {
                    if (predictorId === 'initialized') return;
                    
                    const predictor = predictors[predictorId];
                    
                    // Check if prediction already exists for next period
                    const hasPrediction = predictor.predictions && 
                        predictor.predictions.some(p => p.period === nextPeriod);
                    
                    if (!hasPrediction) {
                        // Add new prediction to the beginning
                        const newPrediction = {
                            period: nextPeriod,
                            prediction: predictionType,
                            result: null,
                            status: 'PENDING',
                            timestamp: Date.now()
                        };
                        
                        // Keep only last 10 predictions
                        let updatedPredictions = predictor.predictions || [];
                        updatedPredictions = [newPrediction, ...updatedPredictions];
                        if (updatedPredictions.length > 10) {
                            updatedPredictions = updatedPredictions.slice(0, 10);
                        }
                        
                        // Update predictor in Firebase
                        database.ref(`predictors/${predictorId}/predictions`).set(updatedPredictions);
                        database.ref(`predictors/${predictorId}/currentPrediction`).set(newPrediction);
                        database.ref(`predictors/${predictorId}/lastUpdated`).set(Date.now());
                    }
                });
            });
        }

        // Check and update predictions
        function checkAndUpdatePredictions(period, result) {
            // Skip if we already processed this period
            if (processedPeriods.has(period)) return;
            
            database.ref('predictors').once('value').then(snapshot => {
                const predictors = snapshot.val();
                if (!predictors) return;
                
                let updatedPredictors = false;
                
                Object.keys(predictors).forEach(predictorId => {
                    if (predictorId === 'initialized') return;
                    
                    const predictor = predictors[predictorId];
                    const predictions = predictor.predictions || [];
                    
                    // Find prediction for this period
                    const predictionIndex = predictions.findIndex(p => 
                        p.period === period && p.status === 'PENDING'
                    );
                    
                    if (predictionIndex !== -1) {
                        const prediction = predictions[predictionIndex];
                        
                        // Check if prediction is correct
                        let isWin = false;
                        if (prediction.prediction === 'BIG') {
                            isWin = result >= 5; // Big: 5,6,7,8,9
                        } else {
                            isWin = result <= 4; // Small: 0,1,2,3,4
                        }
                        
                        // Update prediction status
                        predictions[predictionIndex].result = result;
                        predictions[predictionIndex].status = isWin ? 'WIN' : 'LOSS';
                        predictions[predictionIndex].timestamp = Date.now();
                        
                        // Update predictor stats
                        const currentWins = predictor.wins || 0;
                        const currentLosses = predictor.losses || 0;
                        const currentTotal = predictor.totalPredictions || 0;
                        
                        const newWins = isWin ? currentWins + 1 : currentWins;
                        const newLosses = !isWin ? currentLosses + 1 : currentLosses;
                        const newTotal = currentTotal + 1;
                        const newAccuracy = newTotal > 0 ? Math.round((newWins / newTotal) * 100) : 0;
                        
                        // Update in Firebase
                        database.ref(`predictors/${predictorId}`).update({
                            predictions: predictions,
                            wins: newWins,
                            losses: newLosses,
                            totalPredictions: newTotal,
                            accuracy: newAccuracy,
                            lastUpdated: Date.now()
                        });
                        
                        updatedPredictors = true;
                        processedPeriods.add(period);
                    }
                });
                
                // Recalculate ranks after updates
                if (updatedPredictors) {
                    setTimeout(() => {
                        recalculateRanks();
                    }, 1000);
                }
            });
        }

        // Recalculate ranks
        function recalculateRanks() {
            database.ref('predictors').once('value').then(snapshot => {
                const predictors = snapshot.val();
                if (!predictors) return;
                
                const predictorList = [];
                Object.keys(predictors).forEach(predictorId => {
                    if (predictorId !== 'initialized') {
                        predictorList.push({
                            id: predictorId,
                            ...predictors[predictorId]
                        });
                    }
                });
                
                // Sort by accuracy
                predictorList.sort((a, b) => {
                    if (b.accuracy !== a.accuracy) {
                        return b.accuracy - a.accuracy;
                    }
                    return b.wins - a.wins;
                });
                
                // Update ranks
                predictorList.forEach((predictor, index) => {
                    database.ref(`predictors/${predictor.id}/rank`).set(index + 1);
                });
            });
        }

        // Listen to predictor updates
        function listenToPredictorUpdates() {
            database.ref('predictors').on('value', snapshot => {
                const predictors = snapshot.val();
                if (!predictors) return;
                
                // Convert to array
                predictorData = [];
                Object.keys(predictors).forEach(predictorId => {
                    if (predictorId !== 'initialized') {
                        predictorData.push(predictors[predictorId]);
                    }
                });
                
                // Sort by rank
                predictorData.sort((a, b) => a.rank - b.rank);
                
                // Update UI
                updatePredictorsGrid();
            });
        }

        // Update Predictors Grid with correct avatars
        function updatePredictorsGrid() {
            const predictorsContainer = document.getElementById('predictorsContainer');
            predictorsContainer.innerHTML = '';
            
            if (predictorData.length === 0) {
                predictorsContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3" style="color: #b0b0ff;">Loading predictors...</p>
                    </div>
                `;
                return;
            }
            
            predictorData.forEach((predictor, index) => {
                const latestPrediction = predictor.predictions && predictor.predictions.length > 0 ? 
                    predictor.predictions[0] : null;
                
                const card = document.createElement('div');
                card.className = 'predictor-card';
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('animate__animated', 'animate__fadeInUp');
                
                // Use correct avatar image
                const avatarIndex = predictorNames.indexOf(predictor.name);
                const avatarSrc = avatarIndex !== -1 ? avatars[avatarIndex] : predictor.avatar;
                
                card.innerHTML = `
                    <div class="predictor-rank predictor-rank-${predictor.rank <= 3 ? predictor.rank : '4'}">
                        #${predictor.rank}
                    </div>
                    
                    <div class="d-flex align-items-center mb-3">
                        <img src="${avatarSrc}" class="predictor-avatar" onerror="this.src='https://via.placeholder.com/80?text=${predictor.name.charAt(0)}'">
                        <div class="ms-3">
                            <div class="predictor-name">${predictor.name}</div>
                            <div class="accuracy-badge">
                                <i class="fas fa-bullseye"></i> ${predictor.accuracy}% Accuracy
                            </div>
                        </div>
                    </div>
                    
                    ${latestPrediction ? `
                    <div class="prediction-display">
                        <div class="prediction-label">Current Prediction</div>
                        <div class="prediction-value">${latestPrediction.prediction}</div>
                        <div class="prediction-status status-${latestPrediction.status.toLowerCase()}">
                            ${latestPrediction.status} • Period: ${latestPrediction.period ? latestPrediction.period.slice(-5) : '--'}
                        </div>
                    </div>
                    ` : ''}
                    
                    <div class="d-flex justify-content-between mt-3" style="color: #b0b0ff; font-size: 14px;">
                        <div>W: ${predictor.wins || 0}</div>
                        <div>L: ${predictor.losses || 0}</div>
                        <div>Total: ${predictor.totalPredictions || 0}</div>
                    </div>
                `;
                
                predictorsContainer.appendChild(card);
            });
        }

        // Create particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            particlesContainer.innerHTML = '';
            
            const particleCount = 30;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Logout User - UPDATED TO PREVENT MULTIPLE LOGOUTS
        function logoutUser() {
            // Check if user can logout (prevent multiple logouts)
            if (!currentUser || !userData) {
                return;
            }
            
            // Ask for confirmation
            if (!confirm("Are you sure you want to logout?")) {
                return;
            }
            
            if (refreshInterval) {
                clearInterval(refreshInterval);
            }
            if (accessTimerInterval) {
                clearInterval(accessTimerInterval);
            }
            
            // Update login status in database
            if (currentUser) {
                database.ref('users/' + currentUser).update({
                    isLoggedIn: false,
                    loginDevice: null
                });
            }
            
            // Clear local storage
            localStorage.removeItem('loggedInUser');
            localStorage.removeItem('userData');
            localStorage.removeItem('deviceId');
            localStorage.removeItem('registeredDevice');
            
            // Reset variables
            currentUser = null;
            userData = null;
            deviceId = null;
            
            // Show registration popup
            registrationPopup.style.display = 'flex';
            mainDashboard.style.display = 'none';
            showRegister();
            
            // Reload page to reset state
            setTimeout(() => {
                location.reload();
            }, 500);
        }

        // Check Referral Code from URL
        function checkReferralCode() {
            const urlParams = new URLSearchParams(window.location.search);
            const refCode = urlParams.get('ref');
            if (refCode) {
                document.getElementById('referralCode').value = refCode;
            }
        }

        // Check if user is already logged in
        function checkLoginStatus() {
            const loggedInUser = localStorage.getItem('loggedInUser');
            const savedUserData = localStorage.getItem('userData');
            const registeredDevice = localStorage.getItem('registeredDevice');
            
            if (loggedInUser && savedUserData && registeredDevice) {
                try {
                    currentUser = loggedInUser;
                    userData = JSON.parse(savedUserData);
                    deviceId = generateDeviceId();
                    
                    // Check if device matches
                    if (userData.deviceId !== deviceId) {
                        // Different device, need to login again
                        logoutUser();
                        return;
                    }
                    
                    // Check login status in database
                    database.ref('users/' + currentUser).once('value')
                        .then(snapshot => {
                            if (!snapshot.exists()) {
                                logoutUser();
                                return;
                            }
                            
                            const dbUser = snapshot.val();
                            
                            // Check if user is logged in on another device
                            if (dbUser.isLoggedIn && dbUser.loginDevice !== deviceId) {
                                // Logged in on another device, force logout here
                                logoutUser();
                                return;
                            }
                            
                            // Update local user data
                            userData = dbUser;
                            
                            // Hide registration popup
                            registrationPopup.style.display = 'none';
                            
                            // Check user status
                            if (!userData.tasksCompleted) {
                                showTelegramPopup();
                            } else if (!userData.accessUntil || userData.accessUntil < Date.now()) {
                                showTasksPopup();
                            } else {
                                showDashboard();
                            }
                        })
                        .catch(() => {
                            logoutUser();
                        });
                } catch (e) {
                    console.error('Error parsing saved user data:', e);
                    logoutUser();
                }
            } else {
                registrationPopup.style.display = 'flex';
            }
        }

        // Prevent multiple registrations from same device
        function checkDeviceRegistration() {
            const registeredDevice = localStorage.getItem('registeredDevice');
            if (registeredDevice) {
                // Device already registered, check if user exists
                database.ref('users').orderByChild('deviceId').equalTo(registeredDevice).once('value')
                    .then(snapshot => {
                        if (snapshot.exists()) {
                            // Auto login
                            const userKey = Object.keys(snapshot.val())[0];
                            const user = snapshot.val()[userKey];
                            
                            currentUser = userKey;
                            userData = user;
                            
                            localStorage.setItem('loggedInUser', userKey);
                            localStorage.setItem('userData', JSON.stringify(user));
                            
                            registrationPopup.style.display = 'none';
                            
                            if (!user.tasksCompleted) {
                                showTelegramPopup();
                            } else if (!user.accessUntil || user.accessUntil < Date.now()) {
                                showTasksPopup();
                            } else {
                                showDashboard();
                            }
                        }
                    });
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            checkReferralCode();
            checkDeviceRegistration();
            checkLoginStatus();
            
            // Prevent form submission
            document.addEventListener('submit', function(e) {
                e.preventDefault();
            });
        });
    </script>
</body>
</html>