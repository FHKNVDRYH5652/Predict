<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WinGo Pro Analyst - Advanced AI Predictor</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Animate.css for smooth animations -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <style>
        :root {
            --primary-gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            --secondary-gradient: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            --gold-gradient: linear-gradient(135deg, #FFD700 0%, #FFA500 100%);
            --silver-gradient: linear-gradient(135deg, #C0C0C0 0%, #A9A9A9 100%);
            --bronze-gradient: linear-gradient(135deg, #CD7F32 0%, #8B4513 100%);
            --premium-bg: radial-gradient(circle at 50% 0%, #0a0a2a 0%, #000 100%);
            --card-bg: rgba(255, 255, 255, 0.08);
            --accent: #FF0080;
            --success: #00ff88;
            --danger: #ff4757;
            --warning: #ffcc00;
            --info: #00bfff;
            --text-primary: #ffffff;
            --text-secondary: #b0b0ff;
            --glass-bg: rgba(255, 255, 255, 0.05);
            --glass-border: rgba(255, 255, 255, 0.1);
            --neon-blue: #00f3ff;
            --neon-pink: #ff00ff;
            --neon-green: #00ff9d;
        }

        body {
            background: var(--premium-bg);
            color: var(--text-primary);
            font-family: 'Inter', 'Segoe UI', -apple-system, BlinkMacSystemFont, sans-serif;
            overflow-x: hidden;
            min-height: 100vh;
            position: relative;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 30%, rgba(255, 0, 128, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 80% 70%, rgba(0, 243, 255, 0.15) 0%, transparent 40%),
                radial-gradient(circle at 40% 80%, rgba(0, 255, 157, 0.1) 0%, transparent 40%);
            z-index: -2;
            pointer-events: none;
        }

        /* Animated background particles */
        .particles {
            position: fixed;
            width: 100%;
            height: 100%;
            z-index: -1;
            pointer-events: none;
        }

        .particle {
            position: absolute;
            background: var(--neon-blue);
            border-radius: 50%;
            animation: float 15s infinite linear;
        }

        .particle:nth-child(2n) {
            background: var(--neon-pink);
            animation-duration: 20s;
        }

        .particle:nth-child(3n) {
            background: var(--neon-green);
            animation-duration: 25s;
        }

        @keyframes float {
            0%, 100% { transform: translate(0, 0) rotate(0deg); }
            25% { transform: translate(20vw, 40vh) rotate(90deg); }
            50% { transform: translate(40vw, 10vh) rotate(180deg); }
            75% { transform: translate(60vw, 30vh) rotate(270deg); }
        }

        /* Popup Overlay */
        .popup-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.95);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            backdrop-filter: blur(15px);
        }

        .popup-content {
            background: rgba(30, 30, 70, 0.95);
            padding: 40px;
            border-radius: 30px;
            max-width: 500px;
            width: 90%;
            border: 2px solid transparent;
            background-clip: padding-box;
            position: relative;
            box-shadow: 
                0 0 50px rgba(0, 179, 255, 0.3),
                0 25px 50px -12px rgba(0, 0, 0, 0.5);
            animation: pulse-glow 2s infinite alternate;
        }

        .popup-content::before {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff0080, #00f3ff, #ff0080);
            border-radius: 32px;
            z-index: -1;
            animation: rotate-gradient 3s linear infinite;
        }

        @keyframes rotate-gradient {
            0% { filter: hue-rotate(0deg); }
            100% { filter: hue-rotate(360deg); }
        }

        @keyframes pulse-glow {
            0% { box-shadow: 0 0 50px rgba(0, 179, 255, 0.3), 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
            100% { box-shadow: 0 0 70px rgba(0, 179, 255, 0.5), 0 25px 50px -12px rgba(0, 0, 0, 0.5); }
        }

        /* Button Styles */
        .btn-primary-custom {
            background: linear-gradient(135deg, #0088cc, #00b3ff);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.4s;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(0, 136, 204, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-primary-custom::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: 0.5s;
        }

        .btn-primary-custom:hover::before {
            left: 100%;
        }

        .btn-primary-custom:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 136, 204, 0.6);
        }

        .btn-success-custom {
            background: linear-gradient(135deg, #00ff88, #00cc66);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.4s;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-success-custom:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(0, 255, 136, 0.6);
        }

        .btn-warning-custom {
            background: linear-gradient(135deg, #FFA500, #FF8C00);
            border: none;
            color: white;
            padding: 15px 30px;
            border-radius: 15px;
            font-weight: 700;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            width: 100%;
            margin: 10px 0;
            transition: all 0.4s;
            cursor: pointer;
            font-size: 16px;
            text-transform: uppercase;
            letter-spacing: 1px;
            box-shadow: 0 5px 20px rgba(255, 165, 0, 0.4);
            position: relative;
            overflow: hidden;
        }

        .btn-warning-custom:hover {
            transform: translateY(-5px) scale(1.02);
            box-shadow: 0 15px 30px rgba(255, 165, 0, 0.6);
        }

        /* Input Styles */
        .input-custom {
            background: rgba(255, 255, 255, 0.1);
            border: 2px solid rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 15px 20px;
            color: white;
            font-size: 16px;
            width: 100%;
            margin-bottom: 15px;
            transition: all 0.3s;
        }

        .input-custom:focus {
            outline: none;
            border-color: var(--neon-blue);
            box-shadow: 0 0 15px rgba(0, 243, 255, 0.5);
            background: rgba(255, 255,255, 0.15);
        }

        /* Premium Header */
        .premium-header {
            background: rgba(10, 10, 40, 0.8);
            backdrop-filter: blur(20px);
            padding: 30px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }

        .header-glow {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 20% 20%, rgba(255, 0, 128, 0.2) 0%, transparent 50%),
                radial-gradient(circle at 80% 20%, rgba(0, 243, 255, 0.2) 0%, transparent 50%);
        }

        .live-indicator {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            background: rgba(255, 71, 87, 0.2);
            color: #ff4757;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid rgba(255, 71, 87, 0.3);
            backdrop-filter: blur(10px);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { box-shadow: 0 0 10px rgba(255, 71, 87, 0.5); }
            50% { box-shadow: 0 0 20px rgba(255, 71, 87, 0.8); }
        }

        /* Access Timer */
        .access-timer {
            background: rgba(255, 0, 128, 0.1);
            border: 2px solid rgba(255, 0, 128, 0.3);
            border-radius: 15px;
            padding: 15px;
            text-align: center;
            margin: 20px 0;
            backdrop-filter: blur(10px);
        }

        .timer-display {
            font-size: 32px;
            font-weight: 900;
            color: #ff0080;
            font-family: 'Courier New', monospace;
            text-shadow: 0 0 20px rgba(255, 0, 128, 0.7);
            letter-spacing: 2px;
        }

        /* Period Info */
        .period-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 30px;
            margin: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 
                0 10px 30px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 179, 255, 0.1);
            transition: all 0.3s;
            position: relative;
            overflow: hidden;
        }

        .period-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 4px;
            background: linear-gradient(90deg, #ff0080, #00f3ff);
        }

        .period-number {
            font-size: 36px;
            font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 0 30px rgba(0, 243, 255, 0.5);
            letter-spacing: 2px;
        }

        /* Results History */
        .results-container {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin: 30px;
            flex-wrap: wrap;
        }

        .result-circle {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 20px;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
            border: 3px solid rgba(255, 255, 255, 0.2);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }

        .result-circle:hover {
            transform: scale(1.2) rotate(10deg);
            box-shadow: 0 0 25px currentColor;
            z-index: 10;
        }

        .result-big-red { 
            background: linear-gradient(135deg, #ff4757, #ff002b);
            color: white;
        }
        
        .result-small-red { 
            background: linear-gradient(135deg, #ff7b00, #ff5500);
            color: white;
        }
        
        .result-big-green { 
            background: linear-gradient(135deg, #00ff88, #00cc66);
            color: white;
        }
        
        .result-small-green { 
            background: linear-gradient(135deg, #00bfff, #0088cc);
            color: white;
        }

        /* Predictors Grid */
        .predictors-container {
            padding: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 25px;
        }

        .predictor-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(20px);
            border-radius: 25px;
            padding: 25px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.4s;
            cursor: pointer;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
        }

        .predictor-card:hover {
            transform: translateY(-10px) scale(1.02);
            border-color: var(--neon-blue);
            box-shadow: 
                0 20px 40px rgba(0, 0, 0, 0.3),
                0 0 30px rgba(0, 243, 255, 0.3);
        }

        .predictor-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.05), transparent);
            transition: 0.5s;
        }

        .predictor-card:hover::before {
            left: 100%;
        }

        .predictor-rank {
            position: absolute;
            top: 20px;
            right: 20px;
            width: 40px;
            height: 40px;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 900;
            font-size: 16px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        .predictor-rank-1 { 
            background: var(--gold-gradient);
            animation: glow-gold 2s infinite alternate;
        }
        
        .predictor-rank-2 { 
            background: var(--silver-gradient);
            animation: glow-silver 2s infinite alternate;
        }
        
        .predictor-rank-3 { 
            background: var(--bronze-gradient);
            animation: glow-bronze 2s infinite alternate;
        }
        
        .predictor-rank-4 { 
            background: linear-gradient(135deg, #667eea, #764ba2);
        }

        @keyframes glow-gold {
            0% { box-shadow: 0 0 10px rgba(255, 215, 0, 0.5); }
            100% { box-shadow: 0 0 25px rgba(255, 215, 0, 0.8); }
        }

        @keyframes glow-silver {
            0% { box-shadow: 0 0 10px rgba(192, 192, 192, 0.5); }
            100% { box-shadow: 0 0 25px rgba(192, 192, 192, 0.8); }
        }

        @keyframes glow-bronze {
            0% { box-shadow: 0 0 10px rgba(205, 127, 50, 0.5); }
            100% { box-shadow: 0 0 25px rgba(205, 127, 50, 0.8); }
        }

        .predictor-avatar {
            width: 80px;
            height: 80px;
            border-radius: 20px;
            object-fit: cover;
            border: 3px solid var(--neon-blue);
            margin-bottom: 20px;
            box-shadow: 0 0 20px rgba(0, 243, 255, 0.5);
            transition: all 0.3s;
        }

        .predictor-card:hover .predictor-avatar {
            border-color: var(--neon-pink);
            box-shadow: 0 0 25px rgba(255, 0, 255, 0.7);
        }

        .predictor-name {
            font-size: 22px;
            font-weight: 900;
            margin-bottom: 10px;
            color: var(--text-primary);
            background: linear-gradient(135deg, #ffffff, #b0b0ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .accuracy-badge {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            background: rgba(0, 255, 136, 0.2);
            color: #00ff88;
            padding: 8px 16px;
            border-radius: 25px;
            font-size: 14px;
            font-weight: 700;
            border: 1px solid rgba(0, 255, 136, 0.3);
            backdrop-filter: blur(10px);
        }

        .prediction-display {
            background: rgba(0, 243, 255, 0.1);
            padding: 18px;
            border-radius: 18px;
            margin-top: 20px;
            border: 1px solid rgba(0, 243, 255, 0.3);
            backdrop-filter: blur(10px);
            position: relative;
            overflow: hidden;
        }

        .prediction-display::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, #ff0080, #00f3ff);
        }

        .prediction-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .prediction-value {
            font-size: 26px;
            font-weight: 900;
            color: #00f3ff;
            letter-spacing: 1px;
        }

        .prediction-status {
            display: inline-block;
            padding: 6px 15px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 700;
            margin-top: 10px;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .status-pending { 
            background: rgba(255, 204, 0, 0.2); 
            color: #ffcc00;
            border: 1px solid rgba(255, 204, 0, 0.3);
        }
        
        .status-win { 
            background: rgba(0, 255, 136, 0.2); 
            color: #00ff88;
            border: 1px solid rgba(0, 255, 136, 0.3);
            animation: pulse-win 2s infinite;
        }
        
        .status-loss { 
            background: rgba(255, 71, 87, 0.2); 
            color: #ff4757;
            border: 1px solid rgba(255, 71, 87, 0.3);
        }

        @keyframes pulse-win {
            0%, 100% { box-shadow: 0 0 10px rgba(0, 255, 136, 0.3); }
            50% { box-shadow: 0 0 20px rgba(0, 255, 136, 0.6); }
        }

        /* Payment Plans */
        .plan-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 25px;
            margin: 15px 0;
            border: 2px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s;
            backdrop-filter: blur(10px);
            cursor: pointer;
        }

        .plan-card:hover {
            border-color: var(--neon-blue);
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 243, 255, 0.2);
        }

        .plan-card.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.1);
            box-shadow: 0 0 30px rgba(0, 255, 136, 0.3);
        }

        .plan-price {
            font-size: 32px;
            font-weight: 900;
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .plan-duration {
            color: #b0b0ff;
            font-size: 16px;
            margin-bottom: 15px;
        }

        /* Payment QR */
        .qr-container {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 30px;
            margin: 20px 0;
            text-align: center;
            backdrop-filter: blur(10px);
        }

        .qr-code {
            width: 250px;
            height: 250px;
            border-radius: 15px;
            margin: 20px auto;
            border: 3px solid var(--neon-blue);
            box-shadow: 0 0 30px rgba(0, 243, 255, 0.3);
        }

        /* Admin Panel */
        .admin-btn {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.2);
            z-index: 9998;
            transition: all 0.3s;
        }

        .admin-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: scale(1.1);
        }

        .admin-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: rgba(10, 10, 40, 0.95);
            backdrop-filter: blur(20px);
            z-index: 9999;
            transition: right 0.3s ease;
            overflow-y: auto;
            padding: 20px;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
        }

        .admin-panel.open {
            right: 0;
        }

        .admin-header {
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .payment-request-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 15px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .payment-request-card.pending {
            border-left: 4px solid #ffcc00;
        }

        .payment-request-card.approved {
            border-left: 4px solid #00ff88;
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 40px 20px;
            color: var(--text-secondary);
            font-size: 14px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            margin-top: 60px;
            background: rgba(10, 10, 40, 0.5);
            backdrop-filter: blur(20px);
        }

        /* Strategy Indicator */
        .strategy-indicator {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: rgba(0, 179, 255, 0.15);
            color: #00b3ff;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            border: 1px solid rgba(0, 179, 255, 0.3);
            backdrop-filter: blur(10px);
            margin-top: 10px;
        }

        /* Loading Animation */
        .loading-shimmer {
            background: linear-gradient(90deg, 
                rgba(255, 255, 255, 0.05) 0%, 
                rgba(255, 255, 255, 0.1) 50%, 
                rgba(255, 255, 255, 0.05) 100%);
            background-size: 200% 100%;
            animation: shimmer 1.5s infinite;
            border-radius: 10px;
        }

        @keyframes shimmer {
            0% { background-position: -200% 0; }
            100% { background-position: 200% 0; }
        }

        /* Confidence Bar */
        .confidence-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 10px;
        }

        .confidence-fill {
            height: 100%;
            background: linear-gradient(90deg, #00ff88, #00bfff);
            border-radius: 3px;
            width: 0%;
            transition: width 0.5s ease;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .predictors-container {
                grid-template-columns: 1fr;
                padding: 20px;
            }
            
            .period-number {
                font-size: 28px;
            }
            
            .popup-content {
                padding: 20px;
            }
            
            .result-circle {
                width: 50px;
                height: 50px;
                font-size: 18px;
            }
            
            .timer-display {
                font-size: 24px;
            }

            .admin-panel {
                width: 100%;
                right: -100%;
            }
        }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 10px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(10, 10, 40, 0.5);
        }

        ::-webkit-scrollbar-thumb {
            background: linear-gradient(135deg, #ff0080, #00f3ff);
            border-radius: 5px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: linear-gradient(135deg, #ff3399, #33ffff);
        }
    </style>
</head>
<body>
    <!-- Animated Background Particles -->
    <div class="particles" id="particles"></div>

    <!-- Registration Popup -->
    <div id="registrationPopup" class="popup-overlay">
        <div class="popup-content">
            <div class="text-center mb-4">
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-user-shield"></i> Register Account
                </h2>
                <p style="color: #b0b0ff;">Create your account to access premium predictions</p>
            </div>
            
            <div id="registrationForm">
                <input type="tel" class="input-custom" id="registerPhone" placeholder="Enter Phone Number" required>
                <input type="password" class="input-custom" id="registerPassword" placeholder="Create Password (min 6 characters)" required>
                <input type="password" class="input-custom" id="confirmPassword" placeholder="Confirm Password" required>
                
                <button class="btn-primary-custom" onclick="registerUser()">
                    <i class="fas fa-user-plus"></i> REGISTER NOW
                </button>
                
                <p class="text-center mt-3" style="color: #b0b0ff;">
                    Already have an account? 
                    <a href="#" onclick="showLogin()" style="color: #00f3ff; text-decoration: none;">Login Here</a>
                </p>
            </div>
            
            <div id="loginForm" style="display: none;">
                <input type="tel" class="input-custom" id="loginPhone" placeholder="Phone Number" required>
                <input type="password" class="input-custom" id="loginPassword" placeholder="Password" required>
                
                <button class="btn-primary-custom" onclick="loginUser()">
                    <i class="fas fa-sign-in-alt"></i> LOGIN
                </button>
                
                <p class="text-center mt-3" style="color: #b0b0ff;">
                    Don't have an account? 
                    <a href="#" onclick="showRegister()" style="color: #00f3ff; text-decoration: none;">Register Here</a>
                </p>
            </div>
            
            <div id="registrationMessage" class="mt-3" style="display: none;"></div>
        </div>
    </div>

    <!-- Telegram Popup -->
    <div id="telegramPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="text-center mb-4">
                <div style="width: 100px; height: 100px; background: linear-gradient(135deg, #0088cc, #00b3ff); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 20px; font-size: 48px; color: white; box-shadow: 0 0 30px rgba(0, 179, 255, 0.7);">
                    <i class="fab fa-telegram-plane"></i>
                </div>
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">Join Our Channels</h2>
                <p style="color: #b0b0ff;">Join both channels to access payment options</p>
            </div>
            
            <button class="btn-primary-custom" id="joinBtn1" onclick="joinTelegram(1)">
                <i class="fab fa-telegram-plane"></i> Join Channel 1
            </button>
            <div id="status1" class="text-center mt-2" style="display: none; color: #00f3ff; font-weight: 700;">
                <i class="fas fa-spinner fa-spin"></i> Checking join status...
            </div>
            <div id="joined1" class="text-center mt-2" style="display: none; color: #00ff88; font-weight: 700;">
                <i class="fas fa-check-circle"></i> Joined Successfully
            </div>
            
            <div class="mt-3"></div>
            
            <button class="btn-primary-custom" id="joinBtn2" onclick="joinTelegram(2)" disabled>
                <i class="fab fa-telegram-plane"></i> Join Channel 2
            </button>
            <div id="status2" class="text-center mt-2" style="display: none; color: #00f3ff; font-weight: 700;">
                <i class="fas fa-spinner fa-spin"></i> Checking join status...
            </div>
            <div id="joined2" class="text-center mt-2" style="display: none; color: #00ff88; font-weight: 700;">
                <i class="fas fa-check-circle"></i> Joined Successfully
            </div>
            
            <div id="telegramComplete" style="display: none; margin-top: 30px;">
                <button class="btn-success-custom" onclick="completeTelegramTask()">
                    <i class="fas fa-check-double"></i> TASKS COMPLETED - CONTINUE
                </button>
            </div>
        </div>
    </div>

    <!-- Payment Plans Popup -->
    <div id="paymentPopup" class="popup-overlay" style="display: none;">
        <div class="popup-content">
            <div class="text-center mb-4">
                <h2 style="font-weight: 900; font-size: 32px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-credit-card"></i> Choose Plan
                </h2>
                <p style="color: #b0b0ff;">Select a payment plan to access premium predictions</p>
            </div>
            
            <!-- Payment Plans -->
            <div id="plansContainer">
                <div class="plan-card" onclick="selectPlan(150, 24, '24 Hours Access')">
                    <div class="plan-price">₹150</div>
                    <div class="plan-duration">24 Hours Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-clock"></i> Full access for 24 hours
                    </div>
                </div>
                
                <div class="plan-card" onclick="selectPlan(250, 72, '3 Days Access')">
                    <div class="plan-price">₹250</div>
                    <div class="plan-duration">3 Days Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-clock"></i> Full access for 3 days
                    </div>
                </div>
                
                <div class="plan-card" onclick="selectPlan(500, 240, '10 Days Access')">
                    <div class="plan-price">₹500</div>
                    <div class="plan-duration">10 Days Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-clock"></i> Full access for 10 days
                    </div>
                </div>
                
                <div class="plan-card" onclick="selectPlan(750, 360, '15 Days Access')">
                    <div class="plan-price">₹750</div>
                    <div class="plan-duration">15 Days Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-clock"></i> Full access for 15 days
                    </div>
                </div>
                
                <div class="plan-card" onclick="selectPlan(1500, 2160, '3 Months Access')">
                    <div class="plan-price">₹1500</div>
                    <div class="plan-duration">3 Months Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-crown"></i> Premium access for 3 months
                    </div>
                </div>
                
                <div class="plan-card" onclick="selectPlan(2000, 36500, 'Permanent Access')">
                    <div class="plan-price">₹2000</div>
                    <div class="plan-duration">Permanent Access</div>
                    <div style="color: #b0b0ff; font-size: 14px;">
                        <i class="fas fa-crown"></i> Lifetime access to all features
                    </div>
                </div>
            </div>
            
            <div id="paymentDetails" style="display: none;">
                <div class="qr-container">
                    <h5 style="color: #00f3ff; font-weight: 700; margin-bottom: 20px;">
                        <i class="fas fa-qrcode"></i> Scan QR Code to Pay
                    </h5>
                    <p style="color: #ffffff; font-size: 24px; font-weight: 700; margin-bottom: 10px;">
                        Amount: ₹<span id="selectedAmount">0</span>
                    </p>
                    <p style="color: #b0b0ff; margin-bottom: 20px;" id="selectedPlanText"></p>
                    
                    <img src="qr.png" alt="QR Code" class="qr-code" id="qrCode">
                    
                    <p style="color: #ffcc00; margin-top: 20px; font-weight: 700;">
                        <i class="fas fa-exclamation-circle"></i> Scan & Pay the exact amount
                    </p>
                </div>
                
                <input type="text" class="input-custom" id="utrNumber" placeholder="Enter UTR/Transaction ID">
                <input type="text" class="input-custom" id="paymentAmount" placeholder="Enter Paid Amount">
                
                <button class="btn-success-custom" onclick="submitPayment()">
                    <i class="fas fa-paper-plane"></i> SUBMIT PAYMENT DETAILS
                </button>
                
                <div id="paymentMessage" class="mt-3" style="display: none;"></div>
                
                <button class="btn-warning-custom mt-2" onclick="backToPlans()">
                    <i class="fas fa-arrow-left"></i> BACK TO PLANS
                </button>
            </div>
        </div>
    </div>

    <!-- Admin Panel Button -->
    <div class="admin-btn" id="adminBtn" onclick="openAdminPanel()" style="display: none;">
        <i class="fas fa-cog" style="color: #00f3ff; font-size: 24px;"></i>
    </div>

    <!-- Admin Panel -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-header">
            <h4 style="font-weight: 900; color: #ffffff;">
                <i class="fas fa-user-shield"></i> Admin Panel
            </h4>
            <p style="color: #b0b0ff; font-size: 14px;">Payment Requests Management</p>
            <button class="btn btn-sm btn-danger" onclick="closeAdminPanel()" style="position: absolute; top: 20px; right: 20px;">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div id="adminLogin" style="display: none;">
            <input type="password" class="input-custom" id="adminPassword" placeholder="Enter Admin Password">
            <button class="btn-primary-custom" onclick="loginAdmin()">
                <i class="fas fa-sign-in-alt"></i> LOGIN ADMIN
            </button>
        </div>
        
        <div id="adminContent" style="display: none;">
            <div class="mb-4">
                <h6 style="color: #00f3ff; font-weight: 700;">
                    <i class="fas fa-clock"></i> Pending Payments
                </h6>
                <div id="pendingPayments">
                    <!-- Pending payments will be loaded here -->
                </div>
            </div>
            
            <div>
                <h6 style="color: #00ff88; font-weight: 700;">
                    <i class="fas fa-check-circle"></i> Approved Payments (Last 50)
                </h6>
                <div id="approvedPayments">
                    <!-- Approved payments will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Main Dashboard -->
    <div id="mainDashboard" style="display: none;">
        <!-- Premium Header -->
        <div class="premium-header">
            <div class="header-glow"></div>
            <div class="container">
                <div class="d-flex justify-content-between align-items-center">
                    <div>
                        <h2 class="mb-1" style="font-weight: 900; font-size: 32px;">
                            <i class="fas fa-crown" style="background: linear-gradient(135deg, #FFD700, #FFA500); -webkit-background-clip: text; -webkit-text-fill-color: transparent;"></i> 
                            <span style="background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">WinGo Pro Analyst</span>
                        </h2>
                        <p class="mb-0" style="color: #b0b0ff; font-size: 14px;">
                            <i class="fas fa-user"></i> <span id="userPhoneDisplay"></span> | 
                            <span id="accessStatus" style="color: #00ff88;"></span>
                        </p>
                    </div>
                    <div>
                        <div class="live-indicator">
                            <i class="fas fa-circle"></i> LIVE PREDICTIONS
                        </div>
                        <button class="btn btn-sm btn-outline-warning ms-2" onclick="showPaymentPopup()">
                            <i class="fas fa-credit-card"></i> Extend Access
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Access Timer -->
        <div class="access-timer">
            <div class="small mb-2" style="color: #b0b0ff;">Access Remaining</div>
            <div class="timer-display" id="accessTimer">00:00:00</div>
            <div class="small mt-2" style="color: #ff0080;">
                <i class="fas fa-clock"></i> Extend your access by purchasing a plan
            </div>
        </div>

        <!-- Live Period Info -->
        <div class="period-card animate__animated animate__fadeIn">
            <div class="row align-items-center">
                <div class="col-md-12 text-center">
                    <div class="mb-2" style="color: #b0b0ff; font-size: 14px;">Next Period</div>
                    <div class="period-number" id="currentPeriod">Loading...</div>
                    <div class="small mt-2" id="periodSource" style="color: #b0b0ff;">Source: Connecting...</div>
                    <div class="mt-3" style="color: #00f3ff; font-size: 14px;">
                        <i class="fas fa-sync-alt"></i> Auto-refresh every 5 seconds
                    </div>
                </div>
            </div>
        </div>

        <!-- Latest Results -->
        <div class="container animate__animated animate__fadeInUp">
            <div class="text-center mb-4">
                <h5 style="font-weight: 700; color: #ffffff; font-size: 24px;">
                    <i class="fas fa-history" style="color: #00f3ff;"></i> Latest Results
                </h5>
                <p style="color: #b0b0ff;">Last 10 periods with real-time updates</p>
            </div>
            <div class="results-container" id="latestResults">
                <!-- Results will be loaded here -->
            </div>
        </div>

        <!-- Predictors Grid -->
        <div class="container animate__animated animate__fadeInUp">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <h4 style="font-weight: 900; font-size: 28px; background: linear-gradient(135deg, #ffffff, #b0b0ff); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                    <i class="fas fa-chart-line" style="color: #00f3ff;"></i> Premium Predictors
                </h4>
                <span class="text-muted" id="lastUpdate" style="color: #b0b0ff; font-size: 14px;">Last updated: --</span>
            </div>
            <div class="predictors-container" id="predictorsContainer">
                <!-- Predictors will be loaded here -->
            </div>
        </div>

        <!-- Footer -->
        <div class="footer">
            <div class="container">
                <p style="font-size: 16px; margin-bottom: 15px;">
                    <i class="fas fa-shield-alt" style="color: #00f3ff;"></i> All predictions are AI-generated using advanced algorithms
                </p>
                <p class="mb-0" style="font-size: 14px;">
                    Real-time sync across all devices • Auto-update every 5 seconds • Premium Analytics
                </p>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBHLb-g-WUe8AuiVRIOVolh1MTXF1u7dOc",
            authDomain: "colour-games-dfe2d.firebaseapp.com",
            databaseURL: "https://colour-games-dfe2d-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "colour-games-dfe2d",
            storageBucket: "colour-games-dfe2d.firebasestorage.app",
            messagingSenderId: "92918980466",
            appId: "1:92918980466:web:137e6bc678c0fa76ff07eb",
            measurementId: "G-D7C15NMDJD"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const database = firebase.database();

        // MAIN LIVE API - WORKING API FROM SASTAMAXXWEB
        const API_URL = "https://draw.ar-lottery01.com/WinGo/WinGo_1M/GetHistoryIssuePage.json";
        
        // DOM Elements
        const registrationPopup = document.getElementById('registrationPopup');
        const telegramPopup = document.getElementById('telegramPopup');
        const paymentPopup = document.getElementById('paymentPopup');
        const mainDashboard = document.getElementById('mainDashboard');
        const registrationForm = document.getElementById('registrationForm');
        const loginForm = document.getElementById('loginForm');
        const adminPanel = document.getElementById('adminPanel');
        const adminBtn = document.getElementById('adminBtn');

        // Global Variables
        let currentUser = null;
        let userData = null;
        let refreshInterval;
        let accessTimerInterval;
        let isFirstChannelJoined = false;
        let isSecondChannelJoined = false;
        let currentLivePeriod = null;
        let currentLiveResult = null;
        let lastResultList = [];
        let processedPeriods = new Set();
        let deviceId = null;
        let selectedPlan = null;
        let userListener = null;
        let historicalData = []; // Last 500 results storage
        let predictorData = []; // Store predictor data locally

        // Payment Plans
        const PAYMENT_PLANS = [
            { amount: 150, hours: 24, text: "24 Hours Access" },
            { amount: 250, hours: 72, text: "3 Days Access" },
            { amount: 500, hours: 240, text: "10 Days Access" },
            { amount: 750, hours: 360, text: "15 Days Access" },
            { amount: 1500, hours: 2160, text: "3 Months Access" },
            { amount: 2000, hours: 36500, text: "Permanent Access" }
        ];

        // Predictor Details with Strategy Names
        const predictorNames = [
            {name: "Cyber Seer Pro", strategy: "Cybernetic Probability Engine"},
            {name: "Neural Prophet X1", strategy: "Neural Pattern Recognition"},
            {name: "Digital Oracle Plus", strategy: "Digital Oracle Algorithm"},
            {name: "Quantum Oracle V2", strategy: "Quantum Sequence Analysis"},
            {name: "Alpha Predict AI", strategy: "Alpha Prediction Matrix"},
            {name: "Synapse Mastermind", strategy: "Synapse Master Algorithm"},
            {name: "Neuro Vision Ultra", strategy: "Neuro Vision Technology"},
            {name: "Quantum Mind Plus", strategy: "Quantum Mind Processing"},
            {name: "AI Oracle Premium", strategy: "AI Oracle Algorithm"},
            {name: "Neural Network Pro", strategy: "Neural Network Analysis"}
        ];

        // Predictor Avatars
        const avatars = [
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Cyber",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Neural",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Oracle",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Quantum",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Alpha",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Synapse",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Neuro",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Mind",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=AI",
            "https://api.dicebear.com/7.x/avataaars/svg?seed=Network"
        ];

        // Prediction types
        const PREDICTION_TYPES = ['BIG', 'SMALL', 'RED', 'GREEN'];

        // Number color mapping
        const NUMBER_COLOR_MAP = {
            0: {color: 'RED', violet: true},
            1: {color: 'GREEN', violet: false},
            2: {color: 'RED', violet: false},
            3: {color: 'GREEN', violet: false},
            4: {color: 'RED', violet: false},
            5: {color: 'GREEN', violet: true},
            6: {color: 'RED', violet: false},
            7: {color: 'GREEN', violet: false},
            8: {color: 'RED', violet: false},
            9: {color: 'GREEN', violet: false}
        };

        // Helper function to get result type
        function getResultType(number) {
            const num = parseInt(number);
            if (num >= 5) return 'BIG';
            return 'SMALL';
        }

        // Helper function to get result color
        function getResultColor(number) {
            const num = parseInt(number);
            return NUMBER_COLOR_MAP[num].color;
        }

        // Helper function to get result code (B/S)
        function getResultCode(number) {
            const num = parseInt(number);
            return num >= 5 ? 'B' : 'S';
        }

        // Helper function to get color code (R/G)
        function getColorCode(number) {
            const num = parseInt(number);
            return NUMBER_COLOR_MAP[num].color === 'RED' ? 'R' : 'G';
        }

        // ==================== 10 ADVANCED STRATEGY FUNCTIONS ====================

        // Strategy 1: 7-Digit Pattern Analysis
        function strategy7DigitPattern(sequence) {
            if (sequence.length < 7) return null;
            const patternMaps7 = {
                'BBBBBBB': 'S', 'SSSSSSS': 'B',
                'BBBBBBS': 'S', 'SSSSSSB': 'B',
                'BBBBSSS': 'B', 'SSSSBBB': 'S',
                'BBBBSBB': 'S', 'SSSBSBB': 'B',
                'BBSBSBS': 'B', 'SSBSBSB': 'S'
            };
            const last7 = sequence.slice(-7).join('');
            return patternMaps7[last7] || null;
        }

        // Strategy 2: 6-Digit Pattern Analysis
        function strategy6DigitPattern(sequence) {
            if (sequence.length < 6) return null;
            const patternMaps6 = {
                'BBBBBB': 'S', 'SSSSSS': 'B',
                'BBBBBS': 'S', 'SSSSSB': 'B',
                'BBBSSS': 'B', 'SSSBBB': 'S',
                'BBSBBS': 'S', 'SSBSSB': 'B',
                'BSBSBS': 'B', 'SBSBSB': 'S'
            };
            const last6 = sequence.slice(-6).join('');
            return patternMaps6[last6] || null;
        }

        // Strategy 3: 5-Digit Pattern Analysis
        function strategy5DigitPattern(sequence) {
            if (sequence.length < 5) return null;
            const patternMaps5 = {
                'BBBBB': 'S', 'SSSSS': 'B',
                'BBBBSS': 'B', 'SSSSBB': 'S',
                'BBSBB': 'S', 'SSBSS': 'B',
                'BSBSB': 'S', 'SBSBS': 'B',
                'BBSSB': 'S', 'SSBBS': 'B'
            };
            const last5 = sequence.slice(-5).join('');
            return patternMaps5[last5] || null;
        }

        // Strategy 4: Moving Average Reversal
        function strategyMovingAverage(sequence) {
            if (sequence.length < 20) return null;
            const last20 = sequence.slice(-20);
            const bigCount = last20.filter(x => x === 'B').length;
            const smallCount = last20.filter(x => x === 'S').length;
            
            if (bigCount > smallCount + 5) return 'S';
            if (smallCount > bigCount + 5) return 'B';
            
            const last5 = sequence.slice(-5);
            const last5Big = last5.filter(x => x === 'B').length;
            if (last5Big >= 3) return 'S';
            return 'B';
        }

        // Strategy 5: Frequency Analysis
        function strategyFrequency(sequence) {
            if (sequence.length < 100) return null;
            const last100 = sequence.slice(-100);
            
            const bigFreq = last100.filter(x => x === 'B').length;
            const smallFreq = last100.filter(x => x === 'S').length;
            
            if (bigFreq > 65) return 'S';
            if (smallFreq > 65) return 'B';
            
            const last10 = sequence.slice(-10);
            const last10Big = last10.filter(x => x === 'B').length;
            return last10Big >= 5 ? 'S' : 'B';
        }

        // Strategy 6: Color Pattern Analysis
        function strategyColorPattern(sequence, colorSequence) {
            if (colorSequence.length < 10) return null;
            const last10Color = colorSequence.slice(-10);
            
            const redCount = last10Color.filter(x => x === 'R').length;
            const greenCount = last10Color.filter(x => x === 'G').length;
            
            if (redCount > 7) return 'G';
            if (greenCount > 7) return 'R';
            
            const last3Color = colorSequence.slice(-3).join('');
            if (last3Color === 'RRR') return 'G';
            if (last3Color === 'GGG') return 'R';
            if (last3Color === 'RGR') return 'G';
            if (last3Color === 'GRG') return 'R';
            
            return Math.random() > 0.5 ? 'R' : 'G';
        }

        // Strategy 7: Wave Pattern Detection
        function strategyWavePattern(sequence) {
            if (sequence.length < 15) return null;
            const last15 = sequence.slice(-15);
            
            const pattern = last15.join('');
            if (pattern.includes('BSBSB')) return 'S';
            if (pattern.includes('SBSBS')) return 'B';
            if (pattern.includes('BBSSBB')) return 'S';
            if (pattern.includes('SSBBSS')) return 'B';
            
            let changes = 0;
            for (let i = 1; i < last15.length; i++) {
                if (last15[i] !== last15[i-1]) changes++;
            }
            
            if (changes / 15 > 0.6) {
                return last15[last15.length - 1] === 'B' ? 'S' : 'B';
            }
            
            return last15[last15.length - 1] === 'B' ? 'S' : 'B';
        }

        // Strategy 8: Fibonacci Sequence Analysis
        function strategyFibonacci(sequence) {
            if (sequence.length < 21) return null;
            
            const fibPositions = [1, 2, 3, 5, 8, 13, 21];
            let bigCount = 0;
            
            for (const pos of fibPositions) {
                if (sequence[sequence.length - pos] === 'B') bigCount++;
            }
            
            if (bigCount >= 5) return 'S';
            if (bigCount <= 2) return 'B';
            
            const last = sequence[sequence.length - 1];
            return last === 'B' ? 'S' : 'B';
        }

        // Strategy 9: Cluster Analysis
        function strategyClusterAnalysis(sequence) {
            if (sequence.length < 30) return null;
            
            const last30 = sequence.slice(-30);
            let currentCluster = 1;
            let maxCluster = 1;
            
            for (let i = 1; i < last30.length; i++) {
                if (last30[i] === last30[i-1]) {
                    currentCluster++;
                    maxCluster = Math.max(maxCluster, currentCluster);
                } else {
                    currentCluster = 1;
                }
            }
            
            if (maxCluster >= 5) {
                const lastType = last30[last30.length - 1];
                return lastType === 'B' ? 'S' : 'B';
            }
            
            const lastType = last30[last30.length - 1];
            return lastType;
        }

        // Strategy 10: Neural Network Simulation
        function strategyNeuralNetwork(sequence) {
            if (sequence.length < 50) return null;
            
            const weights = {
                pattern3: 0.3,
                pattern5: 0.4,
                frequency: 0.2,
                recent: 0.1
            };
            
            const last3 = sequence.slice(-3);
            const last3Score = last3.filter(x => x === 'B').length >= 2 ? 1 : -1;
            
            const last5 = sequence.slice(-5);
            const last5Score = last5.filter(x => x === 'B').length >= 3 ? 1 : -1;
            
            const last20 = sequence.slice(-20);
            const freqScore = last20.filter(x => x === 'B').length > 10 ? 1 : -1;
            
            const recentScore = last5[last5.length - 1] === 'B' ? 1 : -1;
            
            const totalScore = 
                (last3Score * weights.pattern3) +
                (last5Score * weights.pattern5) +
                (freqScore * weights.frequency) +
                (recentScore * weights.recent);
            
            return totalScore > 0 ? 'B' : 'S';
        }

        // Strategy mapping array
        const STRATEGIES = [
            { name: "Cyber Seer Pro", func: strategy7DigitPattern, color: "#ff4757" },
            { name: "Neural Prophet X1", func: strategy6DigitPattern, color: "#00ff88" },
            { name: "Digital Oracle Plus", func: strategy5DigitPattern, color: "#00bfff" },
            { name: "Quantum Oracle V2", func: strategyMovingAverage, color: "#ff0080" },
            { name: "Alpha Predict AI", func: strategyFrequency, color: "#ffcc00" },
            { name: "Synapse Mastermind", func: strategyColorPattern, color: "#9d4edd" },
            { name: "Neuro Vision Ultra", func: strategyWavePattern, color: "#00f3ff" },
            { name: "Quantum Mind Plus", func: strategyFibonacci, color: "#ff9d00" },
            { name: "AI Oracle Premium", func: strategyClusterAnalysis, color: "#00ff9d" },
            { name: "Neural Network Pro", func: strategyNeuralNetwork, color: "#ff00ff" }
        ];

        // ==================== CORE FUNCTIONS ====================

        // Generate Device ID
        function generateDeviceId() {
            deviceId = localStorage.getItem('permanentDeviceId');
            if (!deviceId) {
                deviceId = 'device_' + Date.now() + '_' + Math.floor(Math.random() * 1000000);
                localStorage.setItem('permanentDeviceId', deviceId);
            }
            return deviceId;
        }

        // Setup User Listener
        function setupUserListener() {
            if (!currentUser) return;
            
            if (userListener) {
                userListener();
            }
            
            userListener = database.ref('users/' + currentUser).on('value', (snapshot) => {
                if (snapshot.exists()) {
                    const updatedUserData = snapshot.val();
                    userData = updatedUserData;
                    localStorage.setItem('permanentUserData', JSON.stringify(userData));
                    checkAndShowDashboardOnAccess();
                }
            });
        }

        // Check and show dashboard when access is granted
        function checkAndShowDashboardOnAccess() {
            if (!userData) return;
            
            if (userData.accessUntil && userData.accessUntil > Date.now()) {
                if (mainDashboard.style.display === 'none') {
                    registrationPopup.style.display = 'none';
                    telegramPopup.style.display = 'none';
                    paymentPopup.style.display = 'none';
                    showDashboard();
                    showMessage('Payment approved! Dashboard access granted.', 'success', 'registrationMessage');
                }
            }
        }

        // Show Registration Form
        function showRegister() {
            registrationForm.style.display = 'block';
            loginForm.style.display = 'none';
        }

        // Show Login Form
        function showLogin() {
            registrationForm.style.display = 'none';
            loginForm.style.display = 'block';
        }

        // Register User
        function registerUser() {
            const phone = document.getElementById('registerPhone').value.trim();
            const password = document.getElementById('registerPassword').value;
            const confirmPassword = document.getElementById('confirmPassword').value;
            
            if (!phone) {
                showMessage('Please enter phone number', 'danger');
                return;
            }
            
            if (!password) {
                showMessage('Please enter password', 'danger');
                return;
            }
            
            if (password.length < 6) {
                showMessage('Password must be at least 6 characters', 'danger');
                return;
            }
            
            if (password !== confirmPassword) {
                showMessage('Passwords do not match', 'danger');
                return;
            }
            
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (snapshot.exists()) {
                        showMessage('Phone number already registered. Please login.', 'danger');
                        return;
                    }
                    
                    const deviceId = generateDeviceId();
                    const userId = 'user_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
                    
                    const newUserData = {
                        phone: phone,
                        password: password,
                        userId: userId,
                        deviceId: deviceId,
                        accessUntil: null,
                        telegramTasks: {
                            channel1: false,
                            channel2: false
                        },
                        tasksCompleted: false,
                        registeredAt: Date.now(),
                        lastLogin: Date.now(),
                        isLoggedIn: true,
                        loginDevice: deviceId,
                        isPermanent: true
                    };
                    
                    database.ref('users/' + userId).set(newUserData)
                        .then(() => {
                            currentUser = userId;
                            userData = newUserData;
                            localStorage.setItem('permanentLoggedInUser', userId);
                            localStorage.setItem('permanentUserData', JSON.stringify(newUserData));
                            localStorage.setItem('isPermanentLogin', 'true');
                            setupUserListener();
                            showMessage('Registration successful!', 'success');
                            setTimeout(() => {
                                registrationPopup.style.display = 'none';
                                showTelegramPopup();
                            }, 1500);
                        })
                        .catch(error => {
                            console.error('Registration error:', error);
                            showMessage('Registration failed: ' + error.message, 'danger');
                        });
                })
                .catch(error => {
                    console.error('Registration error:', error);
                    showMessage('Registration failed: ' + error.message, 'danger');
                });
        }

        // Login User
        function loginUser() {
            const phone = document.getElementById('loginPhone').value.trim();
            const password = document.getElementById('loginPassword').value;
            
            if (!phone || !password) {
                showMessage('Please enter phone and password', 'danger');
                return;
            }
            
            database.ref('users').orderByChild('phone').equalTo(phone).once('value')
                .then(snapshot => {
                    if (!snapshot.exists()) {
                        showMessage('Phone number not registered', 'danger');
                        return;
                    }
                    
                    const userKey = Object.keys(snapshot.val())[0];
                    const user = snapshot.val()[userKey];
                    
                    if (user.password !== password) {
                        showMessage('Invalid password', 'danger');
                        return;
                    }
                    
                    const deviceId = generateDeviceId();
                    
                    database.ref('users/' + userKey).update({
                        deviceId: deviceId,
                        lastLogin: Date.now(),
                        isLoggedIn: true,
                        loginDevice: deviceId,
                        isPermanent: true
                    })
                    .then(() => {
                        currentUser = userKey;
                        userData = user;
                        userData.deviceId = deviceId;
                        userData.isLoggedIn = true;
                        userData.loginDevice = deviceId;
                        userData.isPermanent = true;
                        localStorage.setItem('permanentLoggedInUser', userKey);
                        localStorage.setItem('permanentUserData', JSON.stringify(userData));
                        localStorage.setItem('isPermanentLogin', 'true');
                        setupUserListener();
                        registrationPopup.style.display = 'none';
                        
                        if (!user.tasksCompleted) {
                            showTelegramPopup();
                        } else if (!user.accessUntil || user.accessUntil < Date.now()) {
                            showPaymentPopup();
                        } else {
                            showDashboard();
                        }
                    });
                })
                .catch(error => {
                    console.error('Login error:', error);
                    showMessage('Login failed: ' + error.message, 'danger');
                });
        }

        // Show Message
        function showMessage(message, type, elementId = 'registrationMessage') {
            const messageDiv = document.getElementById(elementId);
            messageDiv.style.display = 'block';
            messageDiv.innerHTML = `
                <div class="alert alert-${type} alert-dismissible fade show" role="alert" style="background: ${type === 'success' ? 'rgba(0,255,136,0.2)' : 'rgba(255,71,87,0.2)'}; border-color: ${type === 'success' ? '#00ff88' : '#ff4757'}; color: white;">
                    ${message}
                    <button type="button" class="btn-close btn-close-white" onclick="this.parentElement.style.display='none'"></button>
                </div>
            `;
            setTimeout(() => {
                messageDiv.style.display = 'none';
            }, 5000);
        }

        // Show Telegram Popup
        function showTelegramPopup() {
            telegramPopup.style.display = 'flex';
            paymentPopup.style.display = 'none';
            mainDashboard.style.display = 'none';
        }

        // Join Telegram Channel
        function joinTelegram(channel) {
            if (channel === 1) {
                window.open('https://t.me/+8GtO9R-G56k5OTE1', '_blank');
                document.getElementById('status1').style.display = 'block';
                document.getElementById('joinBtn1').disabled = true;
                
                setTimeout(() => {
                    document.getElementById('status1').style.display = 'none';
                    document.getElementById('joined1').style.display = 'block';
                    isFirstChannelJoined = true;
                    
                    if (currentUser) {
                        database.ref('users/' + currentUser + '/telegramTasks/channel1').set(true);
                    }
                    
                    document.getElementById('joinBtn2').disabled = false;
                    checkTelegramCompletion();
                }, 10000);
            } else if (channel === 2) {
                window.open('https://t.me/+yCsZtJDFQvtlZjNl', '_blank');
                document.getElementById('status2').style.display = 'block';
                document.getElementById('joinBtn2').disabled = true;
                
                setTimeout(() => {
                    document.getElementById('status2').style.display = 'none';
                    document.getElementById('joined2').style.display = 'block';
                    isSecondChannelJoined = true;
                    
                    if (currentUser) {
                        database.ref('users/' + currentUser + '/telegramTasks/channel2').set(true);
                    }
                    
                    checkTelegramCompletion();
                }, 10000);
            }
        }

        // Check Telegram Completion
        function checkTelegramCompletion() {
            if (isFirstChannelJoined && isSecondChannelJoined) {
                setTimeout(() => {
                    document.getElementById('telegramComplete').style.display = 'block';
                }, 1000);
            }
        }

        // Complete Telegram Task
        function completeTelegramTask() {
            if (!currentUser) return;
            
            database.ref('users/' + currentUser).update({
                tasksCompleted: true
            })
            .then(() => {
                userData.tasksCompleted = true;
                telegramPopup.style.display = 'none';
                showPaymentPopup();
            });
        }

        // Show Payment Popup
        function showPaymentPopup() {
            paymentPopup.style.display = 'flex';
            telegramPopup.style.display = 'none';
            mainDashboard.style.display = 'none';
            
            selectedPlan = null;
            const plans = document.querySelectorAll('.plan-card');
            plans.forEach(plan => plan.classList.remove('selected'));
            document.getElementById('paymentDetails').style.display = 'none';
            document.getElementById('plansContainer').style.display = 'block';
        }

        // Select Plan
        function selectPlan(amount, hours, text) {
            selectedPlan = { amount, hours, text };
            
            const plans = document.querySelectorAll('.plan-card');
            plans.forEach(plan => plan.classList.remove('selected'));
            event.currentTarget.classList.add('selected');
            
            document.getElementById('selectedAmount').textContent = amount;
            document.getElementById('selectedPlanText').textContent = text;
            document.getElementById('paymentAmount').value = amount;
            
            setTimeout(() => {
                document.getElementById('paymentDetails').style.display = 'block';
                document.getElementById('plansContainer').style.display = 'none';
            }, 500);
        }

        // Back to Plans
        function backToPlans() {
            document.getElementById('paymentDetails').style.display = 'none';
            document.getElementById('plansContainer').style.display = 'block';
            document.getElementById('utrNumber').value = '';
            document.getElementById('paymentMessage').style.display = 'none';
        }

        // Submit Payment
        function submitPayment() {
            const utr = document.getElementById('utrNumber').value.trim();
            const paidAmount = document.getElementById('paymentAmount').value.trim();
            
            if (!selectedPlan) {
                showMessage('Please select a plan first', 'danger', 'paymentMessage');
                return;
            }
            
            if (!utr) {
                showMessage('Please enter UTR/Transaction ID', 'danger', 'paymentMessage');
                return;
            }
            
            if (!paidAmount || parseInt(paidAmount) !== selectedPlan.amount) {
                showMessage(`Please enter exact amount: ₹${selectedPlan.amount}`, 'danger', 'paymentMessage');
                return;
            }
            
            const paymentId = 'pay_' + Date.now() + '_' + Math.random().toString(36).substr(2, 9);
            const paymentData = {
                paymentId: paymentId,
                userId: currentUser,
                userPhone: userData.phone,
                amount: selectedPlan.amount,
                hours: selectedPlan.hours,
                planText: selectedPlan.text,
                utr: utr,
                status: 'pending',
                timestamp: Date.now(),
                deviceId: deviceId
            };
            
            database.ref('paymentRequests/' + paymentId).set(paymentData)
                .then(() => {
                    showMessage('Payment submitted successfully! Waiting for admin approval. You will be redirected automatically when approved.', 'success', 'paymentMessage');
                    document.getElementById('utrNumber').value = '';
                    document.getElementById('paymentAmount').value = '';
                    waitForApproval(paymentId);
                })
                .catch(error => {
                    console.error('Payment submission error:', error);
                    showMessage('Payment submission failed: ' + error.message, 'danger', 'paymentMessage');
                });
        }

        // Wait for admin approval
        function waitForApproval(paymentId) {
            database.ref('paymentRequests/' + paymentId).on('value', (snapshot) => {
                const payment = snapshot.val();
                if (payment && payment.status === 'approved') {
                    showMessage('Payment approved! Redirecting to dashboard...', 'success', 'paymentMessage');
                    userData.accessUntil = Date.now() + (selectedPlan.hours * 60 * 60 * 1000);
                    setTimeout(() => {
                        paymentPopup.style.display = 'none';
                        showDashboard();
                    }, 2000);
                    database.ref('paymentRequests/' + paymentId).off();
                } else if (payment && payment.status === 'rejected') {
                    showMessage('Payment rejected by admin. Please contact support.', 'danger', 'paymentMessage');
                    database.ref('paymentRequests/' + paymentId).off();
                }
            });
        }

        // Show Dashboard
        function showDashboard() {
            registrationPopup.style.display = 'none';
            telegramPopup.style.display = 'none';
            paymentPopup.style.display = 'none';
            mainDashboard.style.display = 'block';
            document.getElementById('userPhoneDisplay').textContent = userData.phone;
            startAccessTimer();
            initializeDashboard();
            adminBtn.style.display = 'block';
        }

        // Start Access Timer
        function startAccessTimer() {
            if (accessTimerInterval) {
                clearInterval(accessTimerInterval);
            }
            
            function updateTimer() {
                if (!userData.accessUntil) {
                    document.getElementById('accessTimer').textContent = '00:00:00';
                    document.getElementById('accessStatus').textContent = 'No Access';
                    document.getElementById('accessStatus').style.color = '#ff4757';
                    setTimeout(() => {
                        showPaymentPopup();
                    }, 1000);
                    return;
                }
                
                const now = Date.now();
                const remaining = userData.accessUntil - now;
                
                if (remaining <= 0) {
                    document.getElementById('accessTimer').textContent = '00:00:00';
                    document.getElementById('accessStatus').textContent = 'Access Expired';
                    document.getElementById('accessStatus').style.color = '#ff4757';
                    setTimeout(() => {
                        showPaymentPopup();
                    }, 1000);
                    return;
                }
                
                const days = Math.floor(remaining / (1000 * 60 * 60 * 24));
                const hours = Math.floor((remaining % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((remaining % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((remaining % (1000 * 60)) / 1000);
                
                if (days > 0) {
                    document.getElementById('accessTimer').textContent = 
                        `${days}d ${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                } else {
                    document.getElementById('accessTimer').textContent = 
                        `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}:${seconds.toString().padStart(2, '0')}`;
                }
                
                document.getElementById('accessStatus').textContent = days > 0 ? `${days} Days Access` : `${hours} Hours Access`;
                document.getElementById('accessStatus').style.color = '#00ff88';
            }
            
            updateTimer();
            accessTimerInterval = setInterval(updateTimer, 1000);
        }

        // Initialize Dashboard
        function initializeDashboard() {
            createParticles();
            fetchLiveData();
            refreshInterval = setInterval(fetchLiveData, 5000);
            loadPredictors();
        }

        // Create particles
        function createParticles() {
            const particlesContainer = document.getElementById('particles');
            particlesContainer.innerHTML = '';
            
            const particleCount = 30;
            for (let i = 0; i < particleCount; i++) {
                const particle = document.createElement('div');
                particle.className = 'particle';
                
                const size = Math.random() * 4 + 1;
                particle.style.width = `${size}px`;
                particle.style.height = `${size}px`;
                particle.style.left = `${Math.random() * 100}vw`;
                particle.style.top = `${Math.random() * 100}vh`;
                particle.style.animationDelay = `${Math.random() * 15}s`;
                
                particlesContainer.appendChild(particle);
            }
        }

        // Load Predictors
        function loadPredictors() {
            // First check if predictors exist in Firebase
            database.ref('predictors').once('value').then(snapshot => {
                if (snapshot.exists()) {
                    // Use existing predictors from Firebase
                    const predictors = snapshot.val();
                    updateLocalPredictorData(predictors);
                } else {
                    // Initialize new predictors
                    initializePredictors();
                }
                
                // Listen for updates
                database.ref('predictors').on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const predictors = snapshot.val();
                        updateLocalPredictorData(predictors);
                        updatePredictorsDisplay();
                    }
                });
            });
        }

        // Update local predictor data
        function updateLocalPredictorData(predictors) {
            predictorData = [];
            
            // Convert Firebase object to array
            Object.keys(predictors).forEach(key => {
                if (key !== 'initialized') {
                    predictorData.push({
                        id: key,
                        ...predictors[key]
                    });
                }
            });
            
            // Sort by rank
            predictorData.sort((a, b) => a.rank - b.rank);
        }

        // Initialize Predictors in Firebase
        function initializePredictors() {
            const predictors = {};
            
            predictorNames.forEach((predictor, index) => {
                const predictorId = `predictor_${index + 1}`;
                const strategy = STRATEGIES[index];
                
                // Initialize with some historical data
                const predictions = [];
                let winCount = 0;
                
                // Generate last 10 predictions with random results
                for (let i = 0; i < 10; i++) {
                    const isWin = Math.random() > 0.4; // 60% win rate
                    if (isWin) winCount++;
                    
                    predictions.push({
                        period: `110${70 + i}`,
                        prediction: PREDICTION_TYPES[Math.floor(Math.random() * PREDICTION_TYPES.length)],
                        result: Math.floor(Math.random() * 10),
                        status: isWin ? 'WIN' : 'LOSS',
                        timestamp: Date.now() - (i * 60000)
                    });
                }
                
                const accuracy = Math.round((winCount / 10) * 100);
                
                predictors[predictorId] = {
                    id: predictorId,
                    name: predictor.name,
                    strategy: predictor.strategy,
                    avatar: avatars[index],
                    rank: index + 1,
                    accuracy: accuracy,
                    last10Wins: winCount,
                    last10Losses: 10 - winCount,
                    predictions: predictions,
                    currentPrediction: null,
                    confidence: 70 + Math.floor(Math.random() * 25),
                    lastUpdated: Date.now(),
                    algorithm: STRATEGIES[index].name,
                    color: STRATEGIES[index].color
                };
            });
            
            database.ref('predictors').set(predictors);
            database.ref('predictors/initialized').set(true);
        }

        // Fetch Live Data from API
        async function fetchLiveData() {
            try {
                const response = await fetch(API_URL + "?t=" + Date.now());
                if (response.ok) {
                    const data = await response.json();
                    if (data && data.data && data.data.list && data.data.list.length > 0) {
                        processLiveData(data.data.list);
                    } else {
                        throw new Error('Invalid data format');
                    }
                } else {
                    throw new Error('API request failed');
                }
            } catch (error) {
                console.error("API Error:", error);
                document.getElementById('periodSource').textContent = "Source: Offline • Retrying...";
                if (lastResultList.length > 0) {
                    autoGeneratePredictions();
                }
            }
        }

        // Process Live Data
        function processLiveData(list) {
            const sortedList = list.sort((a, b) => b.issueNumber - a.issueNumber);
            const latest = sortedList[0];
            
            currentLivePeriod = latest.issueNumber;
            currentLiveResult = parseInt(latest.number);
            lastResultList = sortedList.slice(0, 10);
            
            // Update historical data
            updateHistoricalData(sortedList);
            
            // Update display
            updateDisplay(latest, sortedList);
            
            // Generate predictions for next period
            generatePredictionsForNextPeriod();
            
            // Check previous predictions
            checkPreviousPredictions(latest);
        }

        // Update Historical Data
        function updateHistoricalData(list) {
            // Convert list to B/S sequence
            const bsSequence = list.map(item => getResultCode(parseInt(item.number)));
            const colorSequence = list.map(item => getColorCode(parseInt(item.number)));
            
            historicalData = {
                bsSequence: bsSequence,
                colorSequence: colorSequence,
                numbers: list.map(item => parseInt(item.number)),
                periods: list.map(item => item.issueNumber),
                lastUpdated: Date.now()
            };
        }

        // Update Display
        function updateDisplay(latest, allResults) {
            document.getElementById('currentPeriod').textContent = (parseInt(latest.issueNumber) + 1).toString().padStart(4, '0');
            document.getElementById('periodSource').textContent = "Source: Online • Live Data";
            
            updateLatestResults(allResults);
            document.getElementById('lastUpdate').textContent = `Last updated: ${new Date().toLocaleTimeString()}`;
        }

        // Update Latest Results Display
        function updateLatestResults(allResults) {
            const latestResults = document.getElementById('latestResults');
            latestResults.innerHTML = '';
            
            allResults.slice(0, 10).forEach((result, index) => {
                const num = parseInt(result.number);
                const isBig = num >= 5;
                const color = NUMBER_COLOR_MAP[num].color;
                
                let className = '';
                if (isBig && color === 'RED') className = 'result-big-red';
                else if (!isBig && color === 'RED') className = 'result-small-red';
                else if (isBig && color === 'GREEN') className = 'result-big-green';
                else if (!isBig && color === 'GREEN') className = 'result-small-green';
                
                const resultDiv = document.createElement('div');
                resultDiv.className = `result-circle ${className} animate__animated animate__flipInX`;
                resultDiv.style.animationDelay = `${index * 0.1}s`;
                resultDiv.textContent = num;
                resultDiv.title = `Period: ${result.issueNumber.slice(-7)} • ${isBig ? 'BIG' : 'SMALL'} / ${color}`;
                latestResults.appendChild(resultDiv);
            });
        }

        // Generate Predictions for Next Period
        function generatePredictionsForNextPeriod() {
            if (!historicalData.bsSequence || historicalData.bsSequence.length < 10) return;
            
            const nextPeriod = (parseInt(currentLivePeriod) + 1).toString().padStart(4, '0');
            
            predictorNames.forEach((predictor, index) => {
                const predictorId = `predictor_${index + 1}`;
                const strategy = STRATEGIES[index];
                let prediction = null;
                let confidence = 70 + Math.floor(Math.random() * 25);
                
                // Get prediction based on strategy
                if (index === 5) { // Color pattern strategy
                    prediction = strategy.func(historicalData.bsSequence, historicalData.colorSequence);
                } else {
                    prediction = strategy.func(historicalData.bsSequence);
                }
                
                // Convert to prediction type
                let predictionType = 'BIG';
                if (prediction === 'S') predictionType = 'SMALL';
                else if (prediction === 'R') predictionType = 'RED';
                else if (prediction === 'G') predictionType = 'GREEN';
                
                // If no prediction from strategy, use random
                if (!prediction) {
                    predictionType = PREDICTION_TYPES[Math.floor(Math.random() * PREDICTION_TYPES.length)];
                    confidence = 60 + Math.floor(Math.random() * 30);
                }
                
                // Create new prediction
                const newPrediction = {
                    period: nextPeriod,
                    prediction: predictionType,
                    confidence: confidence,
                    status: 'PENDING',
                    timestamp: Date.now(),
                    strategy: predictor.strategy
                };
                
                // Update predictor in Firebase
                database.ref(`predictors/${predictorId}`).update({
                    currentPrediction: newPrediction,
                    lastUpdated: Date.now()
                });
            });
        }

        // Check Previous Predictions
        function checkPreviousPredictions(latestResult) {
            const currentPeriod = latestResult.issueNumber;
            const actualNumber = parseInt(latestResult.number);
            const actualBigSmall = getResultType(actualNumber);
            const actualColor = getResultColor(actualNumber);
            
            if (processedPeriods.has(currentPeriod)) return;
            
            predictorNames.forEach((predictor, index) => {
                const predictorId = `predictor_${index + 1}`;
                
                database.ref(`predictors/${predictorId}`).once('value').then(snapshot => {
                    if (!snapshot.exists()) return;
                    
                    const predictor = snapshot.val();
                    const predictions = predictor.predictions || [];
                    
                    // Check if we have a prediction for this period
                    const hasPrediction = predictions.some(p => p.period === currentPeriod);
                    
                    if (!hasPrediction && predictor.currentPrediction) {
                        const currentPrediction = predictor.currentPrediction;
                        let isWin = false;
                        
                        // Check if prediction is correct
                        if (currentPrediction.prediction === 'BIG' || currentPrediction.prediction === 'SMALL') {
                            isWin = currentPrediction.prediction === actualBigSmall;
                        } else if (currentPrediction.prediction === 'RED' || currentPrediction.prediction === 'GREEN') {
                            isWin = currentPrediction.prediction === actualColor;
                        }
                        
                        // Update current prediction
                        const updatedPrediction = {
                            ...currentPrediction,
                            result: actualNumber,
                            status: isWin ? 'WIN' : 'LOSS',
                            actual: {
                                number: actualNumber,
                                bigSmall: actualBigSmall,
                                color: actualColor
                            }
                        };
                        
                        // Add to predictions array
                        let updatedPredictions = [updatedPrediction, ...predictions];
                        if (updatedPredictions.length > 10) {
                            updatedPredictions = updatedPredictions.slice(0, 10);
                        }
                        
                        // Calculate new accuracy
                        let winCount = 0;
                        updatedPredictions.forEach(p => {
                            if (p.status === 'WIN') winCount++;
                        });
                        
                        const newAccuracy = Math.round((winCount / updatedPredictions.length) * 100);
                        
                        // Update in Firebase
                        database.ref(`predictors/${predictorId}`).update({
                            predictions: updatedPredictions,
                            accuracy: newAccuracy,
                            last10Wins: winCount,
                            last10Losses: updatedPredictions.length - winCount,
                            lastUpdated: Date.now()
                        });
                    }
                });
            });
            
            processedPeriods.add(currentPeriod);
            setTimeout(recalculateRanks, 1000);
        }

        // Recalculate Ranks
        function recalculateRanks() {
            if (predictorData.length === 0) return;
            
            predictorData.sort((a, b) => b.accuracy - a.accuracy);
            
            predictorData.forEach((predictor, index) => {
                database.ref(`predictors/${predictor.id}/rank`).set(index + 1);
            });
        }

        // Update Predictors Display
        function updatePredictorsDisplay() {
            const predictorsContainer = document.getElementById('predictorsContainer');
            
            // If no predictor data yet, show loading
            if (predictorData.length === 0) {
                predictorsContainer.innerHTML = `
                    <div class="col-12 text-center py-5">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                        <p class="mt-3" style="color: #b0b0ff;">Loading predictors...</p>
                    </div>
                `;
                return;
            }
            
            predictorsContainer.innerHTML = '';
            
            predictorData.forEach((predictor, index) => {
                const card = document.createElement('div');
                card.className = 'predictor-card';
                card.style.animationDelay = `${index * 0.1}s`;
                card.classList.add('animate__animated', 'animate__fadeInUp');
                
                const currentPrediction = predictor.currentPrediction;
                const confidence = currentPrediction ? currentPrediction.confidence : 70;
                
                card.innerHTML = `
                    <div class="predictor-rank predictor-rank-${predictor.rank <= 3 ? predictor.rank : '4'}" style="background: ${predictor.color || '#667eea'}">
                        #${predictor.rank}
                    </div>
                    
                    <div class="d-flex align-items-center mb-3">
                        <img src="${predictor.avatar}" class="predictor-avatar" alt="${predictor.name}" 
                             style="border-color: ${predictor.color || '#00f3ff'}">
                        <div class="ms-3">
                            <div class="predictor-name" style="background: linear-gradient(135deg, #ffffff, ${predictor.color || '#b0b0ff'}); -webkit-background-clip: text; -webkit-text-fill-color: transparent;">
                                ${predictor.name}
                            </div>
                            <div class="accuracy-badge" style="background: rgba(${parseInt(predictor.color?.slice(1, 3) || '0', 16)}, ${parseInt(predictor.color?.slice(3, 5) || '255', 16)}, ${parseInt(predictor.color?.slice(5, 7) || '136', 16)}, 0.2); border-color: ${predictor.color || '#00ff88'}; color: ${predictor.color || '#00ff88'}">
                                <i class="fas fa-bullseye"></i> ${predictor.accuracy}% Accuracy
                                <small class="ms-2">(${predictor.last10Wins || 0}W/${predictor.last10Losses || 0}L)</small>
                            </div>
                        </div>
                    </div>
                    
                    ${currentPrediction ? `
                    <div class="prediction-display">
                        <div class="prediction-label">Current Prediction</div>
                        <div class="prediction-value" style="color: ${predictor.color || '#00f3ff'}">${currentPrediction.prediction}</div>
                        <div class="prediction-status status-${currentPrediction.status.toLowerCase()}">
                            ${currentPrediction.status} • Period: ${currentPrediction.period || '--'}
                        </div>
                        <div class="confidence-bar">
                            <div class="confidence-fill" style="width: ${confidence}%; background: linear-gradient(90deg, ${predictor.color || '#00ff88'}, ${predictor.color || '#00bfff'})"></div>
                        </div>
                        <div class="strategy-indicator" style="background: rgba(${parseInt(predictor.color?.slice(1, 3) || '0', 16)}, ${parseInt(predictor.color?.slice(3, 5) || '179', 16)}, ${parseInt(predictor.color?.slice(5, 7) || '255', 16)}, 0.15); border-color: ${predictor.color || '#00b3ff'}; color: ${predictor.color || '#00b3ff'}">
                            <i class="fas fa-brain"></i> ${predictor.strategy}
                        </div>
                    </div>
                    ` : '<div class="text-center py-3" style="color: #b0b0ff;">Waiting for prediction...</div>'}
                `;
                
                predictorsContainer.appendChild(card);
            });
        }

        // Auto generate predictions when offline
        function autoGeneratePredictions() {
            if (!currentLivePeriod) {
                const fakePeriod = 11070 + Math.floor(Math.random() * 100);
                currentLivePeriod = fakePeriod.toString();
            }
            
            generatePredictionsForNextPeriod();
        }

        // Check Permanent Login Status
        function checkPermanentLoginStatus() {
            const permanentLoggedInUser = localStorage.getItem('permanentLoggedInUser');
            const permanentUserData = localStorage.getItem('permanentUserData');
            const isPermanentLogin = localStorage.getItem('isPermanentLogin');
            
            if (permanentLoggedInUser && permanentUserData && isPermanentLogin === 'true') {
                try {
                    currentUser = permanentLoggedInUser;
                    userData = JSON.parse(permanentUserData);
                    deviceId = generateDeviceId();
                    database.ref('users/' + currentUser + '/lastLogin').set(Date.now());
                    setupUserListener();
                    registrationPopup.style.display = 'none';
                    
                    if (!userData.tasksCompleted) {
                        showTelegramPopup();
                    } else if (!userData.accessUntil || userData.accessUntil < Date.now()) {
                        showPaymentPopup();
                    } else {
                        showDashboard();
                    }
                } catch (e) {
                    console.error('Error parsing user data:', e);
                    registrationPopup.style.display = 'flex';
                }
            } else {
                registrationPopup.style.display = 'flex';
            }
        }

        // ==================== ADMIN FUNCTIONS ====================

        function openAdminPanel() {
            document.getElementById('adminLogin').style.display = 'block';
            document.getElementById('adminContent').style.display = 'none';
            adminPanel.classList.add('open');
        }

        function closeAdminPanel() {
            adminPanel.classList.remove('open');
        }

        function loginAdmin() {
            const password = document.getElementById('adminPassword').value;
            
            if (password === '456') {
                document.getElementById('adminLogin').style.display = 'none';
                document.getElementById('adminContent').style.display = 'block';
                loadPaymentRequests();
            } else {
                alert('Incorrect password!');
            }
        }

        function loadPaymentRequests() {
            database.ref('paymentRequests').orderByChild('status').equalTo('pending').on('value', snapshot => {
                const pendingPayments = snapshot.val();
                const pendingContainer = document.getElementById('pendingPayments');
                pendingContainer.innerHTML = '';
                
                if (!pendingPayments) {
                    pendingContainer.innerHTML = '<p style="color: #b0b0ff; text-align: center;">No pending payments</p>';
                    return;
                }
                
                Object.keys(pendingPayments).forEach(paymentId => {
                    const payment = pendingPayments[paymentId];
                    const card = document.createElement('div');
                    card.className = 'payment-request-card pending';
                    card.innerHTML = `
                        <div class="d-flex justify-content-between align-items-start">
                            <div>
                                <h6 style="color: white; font-weight: 700;">${payment.userPhone}</h6>
                                <p style="color: #b0b0ff; font-size: 14px; margin-bottom: 5px;">
                                    Amount: ₹${payment.amount} | ${payment.planText}
                                </p>
                                <p style="color: #ffcc00; font-size: 12px; margin-bottom: 5px;">
                                    UTR: ${payment.utr}
                                </p>
                                <p style="color: #b0b0ff; font-size: 12px;">
                                    Device: ${payment.deviceId ? payment.deviceId.substring(0, 10) + '...' : 'Unknown'}
                                </p>
                            </div>
                            <div>
                                <button class="btn btn-sm btn-success" onclick="approvePayment('${paymentId}', '${payment.userId}', ${payment.amount}, ${payment.hours})">
                                    <i class="fas fa-check"></i> Approve
                                </button>
                                <button class="btn btn-sm btn-danger mt-1" onclick="rejectPayment('${paymentId}')">
                                    <i class="fas fa-times"></i> Reject
                                </button>
                            </div>
                        </div>
                        <div style="color: #888; font-size: 11px; margin-top: 10px;">
                            ${new Date(payment.timestamp).toLocaleString()}
                        </div>
                    `;
                    pendingContainer.appendChild(card);
                });
            });
            
            database.ref('paymentRequests').orderByChild('timestamp').limitToLast(50).on('value', snapshot => {
                const allPayments = snapshot.val();
                const approvedContainer = document.getElementById('approvedPayments');
                approvedContainer.innerHTML = '';
                
                if (!allPayments) {
                    approvedContainer.innerHTML = '<p style="color: #b0b0ff; text-align: center;">No approved payments</p>';
                    return;
                }
                
                const approvedPayments = Object.entries(allPayments)
                    .filter(([id, payment]) => payment.status === 'approved')
                    .sort((a, b) => b[1].timestamp - a[1].timestamp)
                    .slice(0, 50);
                
                if (approvedPayments.length === 0) {
                    approvedContainer.innerHTML = '<p style="color: #b0b0ff; text-align: center;">No approved payments</p>';
                    return;
                }
                
                approvedPayments.forEach(([paymentId, payment]) => {
                    const card = document.createElement('div');
                    card.className = 'payment-request-card approved';
                    card.innerHTML = `
                        <div>
                            <h6 style="color: white; font-weight: 700;">${payment.userPhone}</h6>
                            <p style="color: #b0b0ff; font-size: 14px; margin-bottom: 5px;">
                                Amount: ₹${payment.amount} | ${payment.planText}
                            </p>
                            <p style="color: #00ff88; font-size: 12px; margin-bottom: 5px;">
                                Approved
                            </p>
                        </div>
                        <div style="color: #888; font-size: 11px; margin-top: 10px;">
                            ${new Date(payment.timestamp).toLocaleString()}
                        </div>
                    `;
                    approvedContainer.appendChild(card);
                });
            });
        }

        function approvePayment(paymentId, userId, amount, hours) {
            let accessUntil;
            if (hours === 36500) {
                accessUntil = Date.now() + (100 * 365 * 24 * 60 * 60 * 1000);
            } else {
                accessUntil = Date.now() + (hours * 60 * 60 * 1000);
            }
            
            database.ref('paymentRequests/' + paymentId).update({
                status: 'approved',
                approvedAt: Date.now()
            })
            .then(() => {
                database.ref('users/' + userId).update({
                    accessUntil: accessUntil
                })
                .then(() => {
                    alert('Payment approved successfully! User will be redirected to dashboard automatically.');
                    sendUserNotification(userId, `Your payment of ₹${amount} has been approved. Dashboard access granted for ${hours} hours.`);
                });
            });
        }

        function sendUserNotification(userId, message) {
            const notification = {
                message: message,
                timestamp: Date.now(),
                read: false
            };
            
            database.ref('notifications/' + userId).push(notification);
        }

        function rejectPayment(paymentId) {
            if (confirm('Are you sure you want to reject this payment?')) {
                database.ref('paymentRequests/' + paymentId).update({
                    status: 'rejected',
                    rejectedAt: Date.now()
                })
                .then(() => {
                    alert('Payment rejected!');
                });
            }
        }

        // Initialize on load
        document.addEventListener('DOMContentLoaded', function() {
            checkPermanentLoginStatus();
            
            document.addEventListener('submit', function(e) {
                e.preventDefault();
            });
            
            document.addEventListener('contextmenu', function(e) {
                e.preventDefault();
            });
            
            setInterval(fetchLiveData, 5000);
        });
    </script>
</body>
</html>
